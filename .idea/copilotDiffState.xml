<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/frontend/src/views/docgia/BorrowHistory.vue">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/frontend/src/views/docgia/BorrowHistory.vue" />
              <option name="originalContent" value="&lt;template&gt;&#10;  &lt;div class=&quot;container-fluid px-4 mt-4&quot;&gt;&#10;    &lt;div class=&quot;card shadow&quot;&gt;&#10;      &lt;div class=&quot;card-header bg-info text-white&quot;&gt;&#10;        &lt;h4 class=&quot;mb-0&quot;&gt;&#10;          &lt;i class=&quot;bi bi-clock-history me-2&quot;&gt;&lt;/i&gt;&#10;          Lịch sử mượn sách&#10;        &lt;/h4&gt;&#10;      &lt;/div&gt;&#10;      &lt;div class=&quot;card-body&quot;&gt;&#10;        &lt;!-- Filter tabs --&gt;&#10;        &lt;ul class=&quot;nav nav-pills mb-4&quot;&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'all' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'all'&quot;&#10;            &gt;Tất cả&lt;/a&gt;&#10;          &lt;/li&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'cho_duyet' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'cho_duyet'&quot;&#10;            &gt;Chờ duyệt&lt;/a&gt;&#10;          &lt;/li&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'da_duyet' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'da_duyet'&quot;&#10;            &gt;Đã duyệt&lt;/a&gt;&#10;          &lt;/li&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'da_tra' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'da_tra'&quot;&#10;            &gt;Đã trả&lt;/a&gt;&#10;          &lt;/li&gt;&#10;        &lt;/ul&gt;&#10;&#10;        &lt;!-- Search and Filter Section --&gt;&#10;        &lt;div class=&quot;row mb-3&quot;&gt;&#10;          &lt;div class=&quot;col-md-4&quot;&gt;&#10;            &lt;div class=&quot;input-group&quot;&gt;&#10;              &lt;span class=&quot;input-group-text&quot;&gt;&#10;                &lt;i class=&quot;bi bi-search&quot;&gt;&lt;/i&gt;&#10;              &lt;/span&gt;&#10;              &lt;input&#10;                type=&quot;text&quot;&#10;                class=&quot;form-control&quot;&#10;                placeholder=&quot;Tìm theo tên sách...&quot;&#10;                v-model=&quot;searchQuery&quot;&#10;              /&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;input&#10;              type=&quot;date&quot;&#10;              class=&quot;form-control&quot;&#10;              v-model=&quot;dateFrom&quot;&#10;              placeholder=&quot;Từ ngày&quot;&#10;            /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;input&#10;              type=&quot;date&quot;&#10;              class=&quot;form-control&quot;&#10;              v-model=&quot;dateTo&quot;&#10;              placeholder=&quot;Đến ngày&quot;&#10;            /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-2&quot;&gt;&#10;            &lt;button class=&quot;btn btn-outline-secondary w-100&quot; @click=&quot;clearFilters&quot;&gt;&#10;              &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;              Xóa lọc&#10;            &lt;/button&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Sort Options --&gt;&#10;        &lt;div class=&quot;row mb-3&quot;&gt;&#10;          &lt;div class=&quot;col-md-4&quot;&gt;&#10;            &lt;select class=&quot;form-select&quot; v-model=&quot;sortBy&quot;&gt;&#10;              &lt;option value=&quot;date_desc&quot;&gt;Ngày mượn (Mới nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;date_asc&quot;&gt;Ngày mượn (Cũ nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;name_asc&quot;&gt;Tên sách (A-Z)&lt;/option&gt;&#10;              &lt;option value=&quot;name_desc&quot;&gt;Tên sách (Z-A)&lt;/option&gt;&#10;              &lt;option value=&quot;fine_desc&quot;&gt;Phạt (Cao-Thấp)&lt;/option&gt;&#10;              &lt;option value=&quot;fine_asc&quot;&gt;Phạt (Thấp-Cao)&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-8 text-end&quot;&gt;&#10;            &lt;button class=&quot;btn btn-success&quot; @click=&quot;exportToCSV&quot; :disabled=&quot;filteredHistory.length === 0&quot;&gt;&#10;              &lt;i class=&quot;bi bi-download me-1&quot;&gt;&lt;/i&gt;&#10;              Xuất CSV&#10;            &lt;/button&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Loading state --&gt;&#10;        &lt;div v-if=&quot;isLoading&quot; class=&quot;text-center py-5&quot;&gt;&#10;          &lt;div class=&quot;spinner-border text-info&quot; role=&quot;status&quot;&gt;&#10;            &lt;span class=&quot;visually-hidden&quot;&gt;Đang tải...&lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;p class=&quot;mt-2&quot;&gt;Đang tải lịch sử...&lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Error message --&gt;&#10;        &lt;div v-else-if=&quot;errorMessage&quot; class=&quot;alert alert-warning&quot;&gt;&#10;          &lt;i class=&quot;bi bi-info-circle me-2&quot;&gt;&lt;/i&gt;&#10;          {{ errorMessage }}&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- History list --&gt;&#10;        &lt;div v-else-if=&quot;paginatedHistory.length &gt; 0&quot;&gt;&#10;          &lt;div class=&quot;table-responsive&quot;&gt;&#10;            &lt;table class=&quot;table table-hover&quot;&gt;&#10;              &lt;thead&gt;&#10;                &lt;tr&gt;&#10;                  &lt;th&gt;Tên sách&lt;/th&gt;&#10;                  &lt;th&gt;Tác giả&lt;/th&gt;&#10;                  &lt;th&gt;Số lượng&lt;/th&gt;&#10;                  &lt;th&gt;Ngày mượn&lt;/th&gt;&#10;                  &lt;th&gt;Hạn trả&lt;/th&gt;&#10;                  &lt;th&gt;Trạng thái&lt;/th&gt;&#10;                  &lt;th&gt;Phạt&lt;/th&gt;&#10;                  &lt;th&gt;Ghi chú&lt;/th&gt;&#10;                &lt;/tr&gt;&#10;              &lt;/thead&gt;&#10;              &lt;tbody&gt;&#10;                &lt;tr v-for=&quot;record in paginatedHistory&quot; :key=&quot;record._id&quot;&gt;&#10;                  &lt;td&gt;&#10;                    &lt;strong&gt;{{ getBookTitle(record.MaSach) }}&lt;/strong&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;{{ getBookAuthor(record.MaSach) }}&lt;/td&gt;&#10;                  &lt;td&gt;{{ record.SoQuyen }}&lt;/td&gt;&#10;                  &lt;td&gt;{{ formatDate(record.NgayMuon) }}&lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;span :class=&quot;isOverdue(record.NgayTra, record.TrangThai) ? 'text-danger' : ''&quot;&gt;&#10;                      {{ formatDate(record.NgayTra) }}&#10;                    &lt;/span&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;span :class=&quot;getStatusClass(record.TrangThai)&quot;&gt;&#10;                      {{ record.TrangThai }}&#10;                    &lt;/span&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;span v-if=&quot;record.PhatQuaHan.SoTienPhat &gt; 0&quot; class=&quot;text-danger fw-bold&quot;&gt;&#10;                      {{ formatPrice(record.PhatQuaHan.SoTienPhat) }}&#10;                    &lt;/span&gt;&#10;                    &lt;span v-else class=&quot;text-success&quot;&gt;-&lt;/span&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;small class=&quot;text-muted&quot;&gt;{{ record.PhatQuaHan.message }}&lt;/small&gt;&#10;                  &lt;/td&gt;&#10;                &lt;/tr&gt;&#10;              &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Pagination --&gt;&#10;          &lt;nav aria-label=&quot;Page navigation&quot; v-if=&quot;totalPages &gt; 1&quot;&gt;&#10;            &lt;ul class=&quot;pagination justify-content-center&quot;&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === 1 }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage - 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-left&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li&#10;                class=&quot;page-item&quot;&#10;                v-for=&quot;page in displayPages&quot;&#10;                :key=&quot;page&quot;&#10;                :class=&quot;{ active: currentPage === page }&quot;&#10;              &gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(page)&quot;&gt;{{ page }}&lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === totalPages }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage + 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-right&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;            &lt;/ul&gt;&#10;          &lt;/nav&gt;&#10;&#10;          &lt;!-- Showing info --&gt;&#10;          &lt;div class=&quot;text-center text-muted mb-3&quot;&gt;&#10;            Hiển thị {{ (currentPage - 1) * itemsPerPage + 1 }} -&#10;            {{ Math.min(currentPage * itemsPerPage, sortedAndFilteredHistory.length) }}&#10;            trong tổng số {{ sortedAndFilteredHistory.length }} bản ghi&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Statistics --&gt;&#10;          &lt;div class=&quot;row mt-4&quot;&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-primary&quot;&gt;{{ statistics.total }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Tổng lượt mượn&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-warning&quot;&gt;{{ statistics.pending }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Chờ duyệt&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-success&quot;&gt;{{ statistics.approved }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Đã duyệt&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-secondary&quot;&gt;{{ statistics.returned }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Đã trả&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- No history --&gt;&#10;        &lt;div v-else class=&quot;text-center py-5&quot;&gt;&#10;          &lt;i class=&quot;bi bi-inbox fs-1 text-muted&quot;&gt;&lt;/i&gt;&#10;          &lt;p class=&quot;text-muted mt-2&quot;&gt;Chưa có lịch sử mượn sách&lt;/p&gt;&#10;          &lt;router-link to=&quot;/docgia/search-books&quot; class=&quot;btn btn-info text-white&quot;&gt;&#10;            &lt;i class=&quot;bi bi-search me-1&quot;&gt;&lt;/i&gt;&#10;            Tìm sách để mượn&#10;          &lt;/router-link&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  &lt;/div&gt;&#10;&lt;/template&gt;&#10;&#10;&lt;script setup lang=&quot;ts&quot;&gt;&#10;import { ref, onMounted, computed } from 'vue'&#10;import { bookService } from '../../services/bookService'&#10;import type { TheoDoiMuonSach, Sach } from '../../types/book'&#10;import { TrangThaiMuonSach } from '../../types/book'&#10;&#10;const history = ref&lt;TheoDoiMuonSach[]&gt;([])&#10;const filter = ref&lt;'all' | 'cho_duyet' | 'da_duyet' | 'da_tra'&gt;('all')&#10;const isLoading = ref(false)&#10;const errorMessage = ref('')&#10;&#10;// Search and filter states&#10;const searchQuery = ref('')&#10;const dateFrom = ref('')&#10;const dateTo = ref('')&#10;const sortBy = ref('date_desc')&#10;&#10;// Pagination states&#10;const currentPage = ref(1)&#10;const itemsPerPage = ref(10)&#10;&#10;const filteredHistory = computed(() =&gt; {&#10;  let result = history.value&#10;&#10;  // Filter by status&#10;  if (filter.value !== 'all') {&#10;    const statusMap: Record&lt;string, TrangThaiMuonSach&gt; = {&#10;      cho_duyet: TrangThaiMuonSach.CHO_DUYET,&#10;      da_duyet: TrangThaiMuonSach.DA_DUYET,&#10;      da_tra: TrangThaiMuonSach.DA_TRA&#10;    }&#10;    result = result.filter(h =&gt; h.TrangThai === statusMap[filter.value])&#10;  }&#10;&#10;  // Search by book title&#10;  if (searchQuery.value.trim()) {&#10;    const query = searchQuery.value.toLowerCase()&#10;    result = result.filter(h =&gt;&#10;      getBookTitle(h.MaSach).toLowerCase().includes(query)&#10;    )&#10;  }&#10;&#10;  // Filter by date range&#10;  if (dateFrom.value) {&#10;    const fromDate = new Date(dateFrom.value)&#10;    result = result.filter(h =&gt; new Date(h.NgayMuon) &gt;= fromDate)&#10;  }&#10;&#10;  if (dateTo.value) {&#10;    const toDate = new Date(dateTo.value)&#10;    toDate.setHours(23, 59, 59, 999)&#10;    result = result.filter(h =&gt; new Date(h.NgayMuon) &lt;= toDate)&#10;  }&#10;&#10;  return result&#10;})&#10;&#10;const sortedAndFilteredHistory = computed(() =&gt; {&#10;  const sorted = [...filteredHistory.value]&#10;&#10;  switch (sortBy.value) {&#10;    case 'date_asc':&#10;      return sorted.sort((a, b) =&gt; new Date(a.NgayMuon).getTime() - new Date(b.NgayMuon).getTime())&#10;    case 'date_desc':&#10;      return sorted.sort((a, b) =&gt; new Date(b.NgayMuon).getTime() - new Date(a.NgayMuon).getTime())&#10;    case 'name_asc':&#10;      return sorted.sort((a, b) =&gt; getBookTitle(a.MaSach).localeCompare(getBookTitle(b.MaSach)))&#10;    case 'name_desc':&#10;      return sorted.sort((a, b) =&gt; getBookTitle(b.MaSach).localeCompare(getBookTitle(a.MaSach)))&#10;    case 'fine_asc':&#10;      return sorted.sort((a, b) =&gt; a.PhatQuaHan.SoTienPhat - b.PhatQuaHan.SoTienPhat)&#10;    case 'fine_desc':&#10;      return sorted.sort((a, b) =&gt; b.PhatQuaHan.SoTienPhat - a.PhatQuaHan.SoTienPhat)&#10;    default:&#10;      return sorted&#10;  }&#10;})&#10;&#10;const totalPages = computed(() =&gt; {&#10;  return Math.ceil(sortedAndFilteredHistory.value.length / itemsPerPage.value)&#10;})&#10;&#10;const paginatedHistory = computed(() =&gt; {&#10;  const start = (currentPage.value - 1) * itemsPerPage.value&#10;  const end = start + itemsPerPage.value&#10;  return sortedAndFilteredHistory.value.slice(start, end)&#10;})&#10;&#10;const displayPages = computed(() =&gt; {&#10;  const pages = []&#10;  const maxDisplay = 5&#10;  let startPage = Math.max(1, currentPage.value - Math.floor(maxDisplay / 2))&#10;  let endPage = Math.min(totalPages.value, startPage + maxDisplay - 1)&#10;&#10;  if (endPage - startPage &lt; maxDisplay - 1) {&#10;    startPage = Math.max(1, endPage - maxDisplay + 1)&#10;  }&#10;&#10;  for (let i = startPage; i &lt;= endPage; i++) {&#10;    pages.push(i)&#10;  }&#10;&#10;  return pages&#10;})&#10;&#10;const statistics = computed(() =&gt; {&#10;  return {&#10;    total: history.value.length,&#10;    pending: history.value.filter(h =&gt; h.TrangThai === TrangThaiMuonSach.CHO_DUYET).length,&#10;    approved: history.value.filter(h =&gt; h.TrangThai === TrangThaiMuonSach.DA_DUYET).length,&#10;    returned: history.value.filter(h =&gt; h.TrangThai === TrangThaiMuonSach.DA_TRA).length&#10;  }&#10;})&#10;&#10;const loadHistory = async () =&gt; {&#10;  isLoading.value = true&#10;  errorMessage.value = ''&#10;&#10;  const userIdFromStorage = localStorage.getItem('userId')&#10;&#10;  if (!userIdFromStorage) {&#10;    errorMessage.value = 'Không tìm thấy thông tin người dùng'&#10;    isLoading.value = false&#10;    return&#10;  }&#10;&#10;  try {&#10;    history.value = await bookService.getBorrowHistory(userIdFromStorage)&#10;  } catch (error: any) {&#10;    errorMessage.value = error.message || 'Chưa có lịch sử mượn sách'&#10;  } finally {&#10;    isLoading.value = false&#10;  }&#10;}&#10;&#10;const getBookTitle = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TenSach) {&#10;    return maSach.TenSach&#10;  }&#10;  return 'Đang tải...'&#10;}&#10;&#10;const getBookAuthor = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TacGia) {&#10;    return maSach.TacGia&#10;  }&#10;  return '-'&#10;}&#10;&#10;const formatDate = (date: string): string =&gt; {&#10;  return new Date(date).toLocaleDateString('vi-VN')&#10;}&#10;&#10;const formatPrice = (price: number): string =&gt; {&#10;  return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price)&#10;}&#10;&#10;const isOverdue = (ngayTra: string, trangThai: TrangThaiMuonSach): boolean =&gt; {&#10;  if (trangThai === TrangThaiMuonSach.DA_TRA) return false&#10;  return new Date(ngayTra) &lt; new Date()&#10;}&#10;&#10;const getStatusClass = (status: TrangThaiMuonSach): string =&gt; {&#10;  switch (status) {&#10;    case TrangThaiMuonSach.CHO_DUYET:&#10;      return 'badge bg-warning text-dark'&#10;    case TrangThaiMuonSach.DA_DUYET:&#10;      return 'badge bg-success'&#10;    case TrangThaiMuonSach.DA_TRA:&#10;      return 'badge bg-secondary'&#10;    default:&#10;      return 'badge bg-light text-dark'&#10;  }&#10;}&#10;&#10;const clearFilters = () =&gt; {&#10;  searchQuery.value = ''&#10;  dateFrom.value = ''&#10;  dateTo.value = ''&#10;  currentPage.value = 1&#10;}&#10;&#10;const changePage = (page: number) =&gt; {&#10;  if (page &gt;= 1 &amp;&amp; page &lt;= totalPages.value) {&#10;    currentPage.value = page&#10;  }&#10;}&#10;&#10;const exportToCSV = () =&gt; {&#10;  const headers = ['Tên sách', 'Tác giả', 'Số lượng', 'Ngày mượn', 'Hạn trả', 'Trạng thái', 'Phạt', 'Ghi chú']&#10;  const rows = sortedAndFilteredHistory.value.map(record =&gt; [&#10;    getBookTitle(record.MaSach),&#10;    getBookAuthor(record.MaSach),&#10;    record.SoQuyen,&#10;    formatDate(record.NgayMuon),&#10;    formatDate(record.NgayTra),&#10;    record.TrangThai,&#10;    record.PhatQuaHan.SoTienPhat &gt; 0 ? formatPrice(record.PhatQuaHan.SoTienPhat) : '0',&#10;    record.PhatQuaHan.message || ''&#10;  ])&#10;&#10;  const csvContent = [&#10;    headers.join(','),&#10;    ...rows.map(row =&gt; row.map(cell =&gt; `&quot;${cell}&quot;`).join(','))&#10;  ].join('\n')&#10;&#10;  const BOM = '\uFEFF'&#10;  const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' })&#10;  const link = document.createElement('a')&#10;  const url = URL.createObjectURL(blob)&#10;&#10;  link.setAttribute('href', url)&#10;  link.setAttribute('download', `lich-su-muon-sach-${new Date().toISOString().split('T')[0]}.csv`)&#10;  link.style.visibility = 'hidden'&#10;  document.body.appendChild(link)&#10;  link.click()&#10;  document.body.removeChild(link)&#10;}&#10;&#10;onMounted(() =&gt; {&#10;  loadHistory()&#10;})&#10;&lt;/script&gt;&#10;&#10;&lt;style scoped&gt;&#10;.nav-pills .nav-link {&#10;  color: #6c757d;&#10;}&#10;&#10;.nav-pills .nav-link.active {&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;}&#10;&#10;.table-responsive {&#10;  border-radius: 8px;&#10;}&#10;&lt;/style&gt;&#10;" />
              <option name="updatedContent" value="&lt;template&gt;&#10;  &lt;div class=&quot;container-fluid px-4 mt-4&quot;&gt;&#10;    &lt;div class=&quot;card shadow&quot;&gt;&#10;      &lt;div class=&quot;card-header bg-info text-white&quot;&gt;&#10;        &lt;h4 class=&quot;mb-0&quot;&gt;&#10;          &lt;i class=&quot;bi bi-clock-history me-2&quot;&gt;&lt;/i&gt;&#10;          Lịch sử mượn sách&#10;        &lt;/h4&gt;&#10;      &lt;/div&gt;&#10;      &lt;div class=&quot;card-body&quot;&gt;&#10;        &lt;!-- Filter tabs --&gt;&#10;        &lt;ul class=&quot;nav nav-pills mb-4&quot;&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'all' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'all'&quot;&#10;            &gt;Tất cả&lt;/a&gt;&#10;          &lt;/li&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'cho_duyet' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'cho_duyet'&quot;&#10;            &gt;Chờ duyệt&lt;/a&gt;&#10;          &lt;/li&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'da_duyet' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'da_duyet'&quot;&#10;            &gt;Đã duyệt&lt;/a&gt;&#10;          &lt;/li&gt;&#10;          &lt;li class=&quot;nav-item&quot;&gt;&#10;            &lt;a&#10;              class=&quot;nav-link&quot;&#10;              :class=&quot;{ active: filter === 'da_tra' }&quot;&#10;              href=&quot;#&quot;&#10;              @click.prevent=&quot;filter = 'da_tra'&quot;&#10;            &gt;Đã trả&lt;/a&gt;&#10;          &lt;/li&gt;&#10;        &lt;/ul&gt;&#10;&#10;        &lt;!-- Search and Filter Section --&gt;&#10;        &lt;div class=&quot;row mb-3&quot;&gt;&#10;          &lt;div class=&quot;col-md-4&quot;&gt;&#10;            &lt;div class=&quot;input-group&quot;&gt;&#10;              &lt;span class=&quot;input-group-text&quot;&gt;&#10;                &lt;i class=&quot;bi bi-search&quot;&gt;&lt;/i&gt;&#10;              &lt;/span&gt;&#10;              &lt;input&#10;                type=&quot;text&quot;&#10;                class=&quot;form-control&quot;&#10;                placeholder=&quot;Tìm theo tên sách...&quot;&#10;                v-model=&quot;searchQuery&quot;&#10;              /&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;input&#10;              type=&quot;date&quot;&#10;              class=&quot;form-control&quot;&#10;              v-model=&quot;dateFrom&quot;&#10;              placeholder=&quot;Từ ngày&quot;&#10;            /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;input&#10;              type=&quot;date&quot;&#10;              class=&quot;form-control&quot;&#10;              v-model=&quot;dateTo&quot;&#10;              placeholder=&quot;Đến ngày&quot;&#10;            /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-2&quot;&gt;&#10;            &lt;button class=&quot;btn btn-outline-secondary w-100&quot; @click=&quot;clearFilters&quot;&gt;&#10;              &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;              Xóa lọc&#10;            &lt;/button&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Sort Options --&gt;&#10;        &lt;div class=&quot;row mb-3&quot;&gt;&#10;          &lt;div class=&quot;col-md-4&quot;&gt;&#10;            &lt;select class=&quot;form-select&quot; v-model=&quot;sortBy&quot;&gt;&#10;              &lt;option value=&quot;date_desc&quot;&gt;Ngày mượn (Mới nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;date_asc&quot;&gt;Ngày mượn (Cũ nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;name_asc&quot;&gt;Tên sách (A-Z)&lt;/option&gt;&#10;              &lt;option value=&quot;name_desc&quot;&gt;Tên sách (Z-A)&lt;/option&gt;&#10;              &lt;option value=&quot;fine_desc&quot;&gt;Phạt (Cao-Thấp)&lt;/option&gt;&#10;              &lt;option value=&quot;fine_asc&quot;&gt;Phạt (Thấp-Cao)&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-8 text-end&quot;&gt;&#10;            &lt;button class=&quot;btn btn-success&quot; @click=&quot;exportToCSV&quot; :disabled=&quot;filteredHistory.length === 0&quot;&gt;&#10;              &lt;i class=&quot;bi bi-download me-1&quot;&gt;&lt;/i&gt;&#10;              Xuất CSV&#10;            &lt;/button&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Loading state --&gt;&#10;        &lt;div v-if=&quot;isLoading&quot; class=&quot;text-center py-5&quot;&gt;&#10;          &lt;div class=&quot;spinner-border text-info&quot; role=&quot;status&quot;&gt;&#10;            &lt;span class=&quot;visually-hidden&quot;&gt;Đang tải...&lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;p class=&quot;mt-2&quot;&gt;Đang tải lịch sử...&lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Error message --&gt;&#10;        &lt;div v-else-if=&quot;errorMessage&quot; class=&quot;alert alert-warning&quot;&gt;&#10;          &lt;i class=&quot;bi bi-info-circle me-2&quot;&gt;&lt;/i&gt;&#10;          {{ errorMessage }}&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- History list --&gt;&#10;        &lt;div v-else-if=&quot;paginatedHistory.length &gt; 0&quot;&gt;&#10;          &lt;div class=&quot;table-responsive&quot;&gt;&#10;            &lt;table class=&quot;table table-hover&quot;&gt;&#10;              &lt;thead&gt;&#10;                &lt;tr&gt;&#10;                  &lt;th&gt;Tên sách&lt;/th&gt;&#10;                  &lt;th&gt;Tác giả&lt;/th&gt;&#10;                  &lt;th&gt;Số lượng&lt;/th&gt;&#10;                  &lt;th&gt;Ngày mượn&lt;/th&gt;&#10;                  &lt;th&gt;Hạn trả&lt;/th&gt;&#10;                  &lt;th&gt;Trạng thái&lt;/th&gt;&#10;                  &lt;th&gt;Phạt&lt;/th&gt;&#10;                  &lt;th&gt;Ghi chú&lt;/th&gt;&#10;                &lt;/tr&gt;&#10;              &lt;/thead&gt;&#10;              &lt;tbody&gt;&#10;                &lt;tr v-for=&quot;record in paginatedHistory&quot; :key=&quot;record._id&quot;&gt;&#10;                  &lt;td&gt;&#10;                    &lt;strong&gt;{{ getBookTitle(record.MaSach) }}&lt;/strong&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;{{ getBookAuthor(record.MaSach) }}&lt;/td&gt;&#10;                  &lt;td&gt;{{ record.SoQuyen }}&lt;/td&gt;&#10;                  &lt;td&gt;{{ formatDate(record.NgayMuon) }}&lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;span :class=&quot;isOverdue(record.NgayTra, record.TrangThai) ? 'text-danger' : ''&quot;&gt;&#10;                      {{ formatDate(record.NgayTra) }}&#10;                    &lt;/span&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;span :class=&quot;getStatusClass(record.TrangThai)&quot;&gt;&#10;                      {{ record.TrangThai }}&#10;                    &lt;/span&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;span v-if=&quot;record.PhatQuaHan.SoTienPhat &gt; 0&quot; class=&quot;text-danger fw-bold&quot;&gt;&#10;                      {{ formatPrice(record.PhatQuaHan.SoTienPhat) }}&#10;                    &lt;/span&gt;&#10;                    &lt;span v-else class=&quot;text-success&quot;&gt;-&lt;/span&gt;&#10;                  &lt;/td&gt;&#10;                  &lt;td&gt;&#10;                    &lt;small class=&quot;text-muted&quot;&gt;{{ record.PhatQuaHan.message }}&lt;/small&gt;&#10;                  &lt;/td&gt;&#10;                &lt;/tr&gt;&#10;              &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Pagination --&gt;&#10;          &lt;nav aria-label=&quot;Page navigation&quot; v-if=&quot;totalPages &gt; 1&quot;&gt;&#10;            &lt;ul class=&quot;pagination justify-content-center&quot;&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === 1 }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage - 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-left&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li&#10;                class=&quot;page-item&quot;&#10;                v-for=&quot;page in displayPages&quot;&#10;                :key=&quot;page&quot;&#10;                :class=&quot;{ active: currentPage === page }&quot;&#10;              &gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(page)&quot;&gt;{{ page }}&lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === totalPages }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage + 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-right&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;            &lt;/ul&gt;&#10;          &lt;/nav&gt;&#10;&#10;          &lt;!-- Showing info --&gt;&#10;          &lt;div class=&quot;text-center text-muted mb-3&quot;&gt;&#10;            Hiển thị {{ (currentPage - 1) * itemsPerPage + 1 }} -&#10;            {{ Math.min(currentPage * itemsPerPage, sortedAndFilteredHistory.length) }}&#10;            trong tổng số {{ sortedAndFilteredHistory.length }} bản ghi&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Statistics --&gt;&#10;          &lt;div class=&quot;row mt-4&quot;&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-primary&quot;&gt;{{ statistics.total }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Tổng lượt mượn&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-warning&quot;&gt;{{ statistics.pending }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Chờ duyệt&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-success&quot;&gt;{{ statistics.approved }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Đã duyệt&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;col-md-3&quot;&gt;&#10;              &lt;div class=&quot;card text-center&quot;&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                  &lt;h3 class=&quot;text-secondary&quot;&gt;{{ statistics.returned }}&lt;/h3&gt;&#10;                  &lt;small class=&quot;text-muted&quot;&gt;Đã trả&lt;/small&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- No history --&gt;&#10;        &lt;div v-else class=&quot;text-center py-5&quot;&gt;&#10;          &lt;i class=&quot;bi bi-inbox fs-1 text-muted&quot;&gt;&lt;/i&gt;&#10;          &lt;p class=&quot;text-muted mt-2&quot;&gt;Chưa có lịch sử mượn sách&lt;/p&gt;&#10;          &lt;router-link to=&quot;/docgia/search-books&quot; class=&quot;btn btn-info text-white&quot;&gt;&#10;            &lt;i class=&quot;bi bi-search me-1&quot;&gt;&lt;/i&gt;&#10;            Tìm sách để mượn&#10;          &lt;/router-link&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  &lt;/div&gt;&#10;&lt;/template&gt;&#10;&#10;&lt;script setup lang=&quot;ts&quot;&gt;&#10;import { ref, onMounted, computed } from 'vue'&#10;import { bookService } from '../../services/bookService'&#10;import type { TheoDoiMuonSach, Sach } from '../../types/book'&#10;import { TrangThaiMuonSach } from '../../types/book'&#10;&#10;const history = ref&lt;TheoDoiMuonSach[]&gt;([])&#10;const filter = ref&lt;'all' | 'CHO_DUYET' | 'DA_DUYET' | 'DA_TRA'&gt;('all')&#10;const isLoading = ref(false)&#10;const errorMessage = ref('')&#10;&#10;// Search and filter states&#10;const searchQuery = ref('')&#10;const dateFrom = ref('')&#10;const dateTo = ref('')&#10;const sortBy = ref('date_desc')&#10;&#10;// Pagination states&#10;const currentPage = ref(1)&#10;const itemsPerPage = ref(10)&#10;&#10;const filteredHistory = computed(() =&gt; {&#10;  let result = history.value&#10;&#10;  // Filter by status&#10;  if (filter.value !== 'all') {&#10;    const statusMap: Record&lt;string, TrangThaiMuonSach&gt; = {&#10;      cho_duyet: TrangThaiMuonSach.CHO_DUYET,&#10;      da_duyet: TrangThaiMuonSach.DA_DUYET,&#10;      da_tra: TrangThaiMuonSach.DA_TRA&#10;    }&#10;    result = result.filter(h =&gt; h.TrangThai === statusMap[filter.value])&#10;  }&#10;&#10;  // Search by book title&#10;  if (searchQuery.value.trim()) {&#10;    const query = searchQuery.value.toLowerCase()&#10;    result = result.filter(h =&gt;&#10;      getBookTitle(h.MaSach).toLowerCase().includes(query)&#10;    )&#10;  }&#10;&#10;  // Filter by date range&#10;  if (dateFrom.value) {&#10;    const fromDate = new Date(dateFrom.value)&#10;    result = result.filter(h =&gt; new Date(h.NgayMuon) &gt;= fromDate)&#10;  }&#10;&#10;  if (dateTo.value) {&#10;    const toDate = new Date(dateTo.value)&#10;    toDate.setHours(23, 59, 59, 999)&#10;    result = result.filter(h =&gt; new Date(h.NgayMuon) &lt;= toDate)&#10;  }&#10;&#10;  return result&#10;})&#10;&#10;const sortedAndFilteredHistory = computed(() =&gt; {&#10;  const sorted = [...filteredHistory.value]&#10;&#10;  switch (sortBy.value) {&#10;    case 'date_asc':&#10;      return sorted.sort((a, b) =&gt; new Date(a.NgayMuon).getTime() - new Date(b.NgayMuon).getTime())&#10;    case 'date_desc':&#10;      return sorted.sort((a, b) =&gt; new Date(b.NgayMuon).getTime() - new Date(a.NgayMuon).getTime())&#10;    case 'name_asc':&#10;      return sorted.sort((a, b) =&gt; getBookTitle(a.MaSach).localeCompare(getBookTitle(b.MaSach)))&#10;    case 'name_desc':&#10;      return sorted.sort((a, b) =&gt; getBookTitle(b.MaSach).localeCompare(getBookTitle(a.MaSach)))&#10;    case 'fine_asc':&#10;      return sorted.sort((a, b) =&gt; a.PhatQuaHan.SoTienPhat - b.PhatQuaHan.SoTienPhat)&#10;    case 'fine_desc':&#10;      return sorted.sort((a, b) =&gt; b.PhatQuaHan.SoTienPhat - a.PhatQuaHan.SoTienPhat)&#10;    default:&#10;      return sorted&#10;  }&#10;})&#10;&#10;const totalPages = computed(() =&gt; {&#10;  return Math.ceil(sortedAndFilteredHistory.value.length / itemsPerPage.value)&#10;})&#10;&#10;const paginatedHistory = computed(() =&gt; {&#10;  const start = (currentPage.value - 1) * itemsPerPage.value&#10;  const end = start + itemsPerPage.value&#10;  return sortedAndFilteredHistory.value.slice(start, end)&#10;})&#10;&#10;const displayPages = computed(() =&gt; {&#10;  const pages = []&#10;  const maxDisplay = 5&#10;  let startPage = Math.max(1, currentPage.value - Math.floor(maxDisplay / 2))&#10;  let endPage = Math.min(totalPages.value, startPage + maxDisplay - 1)&#10;&#10;  if (endPage - startPage &lt; maxDisplay - 1) {&#10;    startPage = Math.max(1, endPage - maxDisplay + 1)&#10;  }&#10;&#10;  for (let i = startPage; i &lt;= endPage; i++) {&#10;    pages.push(i)&#10;  }&#10;&#10;  return pages&#10;})&#10;&#10;const statistics = computed(() =&gt; {&#10;  return {&#10;    total: history.value.length,&#10;    pending: history.value.filter(h =&gt; h.TrangThai === TrangThaiMuonSach.CHO_DUYET).length,&#10;    approved: history.value.filter(h =&gt; h.TrangThai === TrangThaiMuonSach.DA_DUYET).length,&#10;    returned: history.value.filter(h =&gt; h.TrangThai === TrangThaiMuonSach.DA_TRA).length&#10;  }&#10;})&#10;&#10;const loadHistory = async () =&gt; {&#10;  isLoading.value = true&#10;  errorMessage.value = ''&#10;&#10;  const userIdFromStorage = localStorage.getItem('userId')&#10;&#10;  if (!userIdFromStorage) {&#10;    errorMessage.value = 'Không tìm thấy thông tin người dùng'&#10;    isLoading.value = false&#10;    return&#10;  }&#10;&#10;  try {&#10;    history.value = await bookService.getBorrowHistory(userIdFromStorage)&#10;  } catch (error: any) {&#10;    errorMessage.value = error.message || 'Chưa có lịch sử mượn sách'&#10;  } finally {&#10;    isLoading.value = false&#10;  }&#10;}&#10;&#10;const getBookTitle = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TenSach) {&#10;    return maSach.TenSach&#10;  }&#10;  return 'Đang tải...'&#10;}&#10;&#10;const getBookAuthor = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TacGia) {&#10;    return maSach.TacGia&#10;  }&#10;  return '-'&#10;}&#10;&#10;const formatDate = (date: string): string =&gt; {&#10;  return new Date(date).toLocaleDateString('vi-VN')&#10;}&#10;&#10;const formatPrice = (price: number): string =&gt; {&#10;  return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price)&#10;}&#10;&#10;const isOverdue = (ngayTra: string, trangThai: TrangThaiMuonSach): boolean =&gt; {&#10;  if (trangThai === TrangThaiMuonSach.DA_TRA) return false&#10;  return new Date(ngayTra) &lt; new Date()&#10;}&#10;&#10;const getStatusClass = (status: TrangThaiMuonSach): string =&gt; {&#10;  switch (status) {&#10;    case TrangThaiMuonSach.CHO_DUYET:&#10;      return 'badge bg-warning text-dark'&#10;    case TrangThaiMuonSach.DA_DUYET:&#10;      return 'badge bg-success'&#10;    case TrangThaiMuonSach.DA_TRA:&#10;      return 'badge bg-secondary'&#10;    default:&#10;      return 'badge bg-light text-dark'&#10;  }&#10;}&#10;&#10;const clearFilters = () =&gt; {&#10;  searchQuery.value = ''&#10;  dateFrom.value = ''&#10;  dateTo.value = ''&#10;  currentPage.value = 1&#10;}&#10;&#10;const changePage = (page: number) =&gt; {&#10;  if (page &gt;= 1 &amp;&amp; page &lt;= totalPages.value) {&#10;    currentPage.value = page&#10;  }&#10;}&#10;&#10;const exportToCSV = () =&gt; {&#10;  const headers = ['Tên sách', 'Tác giả', 'Số lượng', 'Ngày mượn', 'Hạn trả', 'Trạng thái', 'Phạt', 'Ghi chú']&#10;  const rows = sortedAndFilteredHistory.value.map(record =&gt; [&#10;    getBookTitle(record.MaSach),&#10;    getBookAuthor(record.MaSach),&#10;    record.SoQuyen,&#10;    formatDate(record.NgayMuon),&#10;    formatDate(record.NgayTra),&#10;    record.TrangThai,&#10;    record.PhatQuaHan.SoTienPhat &gt; 0 ? formatPrice(record.PhatQuaHan.SoTienPhat) : '0',&#10;    record.PhatQuaHan.message || ''&#10;  ])&#10;&#10;  const csvContent = [&#10;    headers.join(','),&#10;    ...rows.map(row =&gt; row.map(cell =&gt; `&quot;${cell}&quot;`).join(','))&#10;  ].join('\n')&#10;&#10;  const BOM = '\uFEFF'&#10;  const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' })&#10;  const link = document.createElement('a')&#10;  const url = URL.createObjectURL(blob)&#10;&#10;  link.setAttribute('href', url)&#10;  link.setAttribute('download', `lich-su-muon-sach-${new Date().toISOString().split('T')[0]}.csv`)&#10;  link.style.visibility = 'hidden'&#10;  document.body.appendChild(link)&#10;  link.click()&#10;  document.body.removeChild(link)&#10;}&#10;&#10;onMounted(() =&gt; {&#10;  loadHistory()&#10;})&#10;&lt;/script&gt;&#10;&#10;&lt;style scoped&gt;&#10;.nav-pills .nav-link {&#10;  color: #6c757d;&#10;}&#10;&#10;.nav-pills .nav-link.active {&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;}&#10;&#10;.table-responsive {&#10;  border-radius: 8px;&#10;}&#10;&lt;/style&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/frontend/src/views/docgia/BorrowedBooks.vue">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/frontend/src/views/docgia/BorrowedBooks.vue" />
              <option name="originalContent" value="&lt;template&gt;&#10;  &lt;div class=&quot;container-fluid px-4 mt-4&quot;&gt;&#10;    &lt;div class=&quot;card shadow&quot;&gt;&#10;      &lt;div class=&quot;card-header btn-gradient text-white&quot;&gt;&#10;        &lt;h4 class=&quot;mb-0&quot;&gt;&#10;          &lt;i class=&quot;bi bi-bookmark-check me-2&quot;&gt;&lt;/i&gt;&#10;          Sách đã mượn&#10;        &lt;/h4&gt;&#10;      &lt;/div&gt;&#10;      &lt;div class=&quot;card-body&quot;&gt;&#10;        &lt;!-- Search and Filter Section --&gt;&#10;        &lt;div class=&quot;row mb-3&quot;&gt;&#10;          &lt;div class=&quot;col-md-6&quot;&gt;&#10;            &lt;div class=&quot;input-group&quot;&gt;&#10;              &lt;span class=&quot;input-group-text&quot;&gt;&#10;                &lt;i class=&quot;bi bi-search&quot;&gt;&lt;/i&gt;&#10;              &lt;/span&gt;&#10;              &lt;input&#10;                type=&quot;text&quot;&#10;                class=&quot;form-control&quot;&#10;                placeholder=&quot;Tìm theo tên sách hoặc tác giả...&quot;&#10;                v-model=&quot;searchQuery&quot;&#10;              /&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;select class=&quot;form-select&quot; v-model=&quot;statusFilter&quot;&gt;&#10;              &lt;option value=&quot;all&quot;&gt;Tất cả trạng thái&lt;/option&gt;&#10;              &lt;option value=&quot;CHO_DUYET&quot;&gt;Chờ duyệt&lt;/option&gt;&#10;              &lt;option value=&quot;DA_DUYET&quot;&gt;Đã duyệt&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;select class=&quot;form-select&quot; v-model=&quot;sortBy&quot;&gt;&#10;              &lt;option value=&quot;date_desc&quot;&gt;Ngày mượn (Mới nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;date_asc&quot;&gt;Ngày mượn (Cũ nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;due_date_asc&quot;&gt;Hạn trả (Gần nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;name_asc&quot;&gt;Tên sách (A-Z)&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Loading state --&gt;&#10;        &lt;div v-if=&quot;isLoading&quot; class=&quot;text-center py-5&quot;&gt;&#10;          &lt;div class=&quot;spinner-border text-success&quot; role=&quot;status&quot;&gt;&#10;            &lt;span class=&quot;visually-hidden&quot;&gt;Đang tải...&lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;p class=&quot;mt-2&quot;&gt;Đang tải danh sách sách đã mượn...&lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Error message --&gt;&#10;        &lt;div v-else-if=&quot;errorMessage&quot; class=&quot;alert alert-warning&quot;&gt;&#10;          &lt;i class=&quot;bi bi-info-circle me-2&quot;&gt;&lt;/i&gt;&#10;          {{ errorMessage }}&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Borrowed books list --&gt;&#10;        &lt;div v-else-if=&quot;paginatedBorrows.length &gt; 0&quot;&gt;&#10;          &lt;div class=&quot;table-responsive&quot;&gt;&#10;            &lt;table class=&quot;table table-hover&quot;&gt;&#10;              &lt;thead&gt;&#10;              &lt;tr&gt;&#10;                &lt;th&gt;Tên sách&lt;/th&gt;&#10;                &lt;th&gt;Tác giả&lt;/th&gt;&#10;                &lt;th&gt;Số lượng&lt;/th&gt;&#10;                &lt;th&gt;Ngày mượn&lt;/th&gt;&#10;                &lt;th&gt;Hạn trả&lt;/th&gt;&#10;                &lt;th&gt;Trạng thái&lt;/th&gt;&#10;                &lt;th&gt;Phạt&lt;/th&gt;&#10;                &lt;th class=&quot;text-center&quot;&gt;Thao tác&lt;/th&gt;&#10;              &lt;/tr&gt;&#10;              &lt;/thead&gt;&#10;              &lt;tbody&gt;&#10;              &lt;tr v-for=&quot;borrow in paginatedBorrows&quot; :key=&quot;borrow._id&quot;&gt;&#10;                &lt;td&gt;&#10;                  &lt;strong&gt;{{ getBookTitle(borrow.MaSach) }}&lt;/strong&gt;&#10;                &lt;/td&gt;&#10;                &lt;td&gt;{{ getBookAuthor(borrow.MaSach) }}&lt;/td&gt;&#10;                &lt;td&gt;{{ borrow.SoQuyen }}&lt;/td&gt;&#10;                &lt;td&gt;{{ formatDate(borrow.NgayMuon) }}&lt;/td&gt;&#10;                &lt;td&gt;&#10;                    &lt;span :class=&quot;isOverdue(borrow.NgayTra) ? 'text-danger fw-bold' : ''&quot;&gt;&#10;                      {{ formatDate(borrow.NgayTra) }}&#10;                    &lt;/span&gt;&#10;                &lt;/td&gt;&#10;                &lt;td&gt;&#10;                    &lt;span :class=&quot;getStatusClass(borrow.TrangThai)&quot;&gt;&#10;                      {{ borrow.TrangThai }}&#10;                    &lt;/span&gt;&#10;                &lt;/td&gt;&#10;                &lt;td&gt;&#10;                    &lt;span v-if=&quot;borrow.PhatQuaHan.SoTienPhat &gt; 0&quot; class=&quot;text-danger&quot;&gt;&#10;                      {{ formatPrice(borrow.PhatQuaHan.SoTienPhat) }}&#10;                    &lt;/span&gt;&#10;                  &lt;span v-else class=&quot;text-muted&quot;&gt;-&lt;/span&gt;&#10;                &lt;/td&gt;&#10;                &lt;td class=&quot;text-center&quot;&gt;&#10;                  &lt;div class=&quot;btn-group btn-group-sm&quot;&gt;&#10;                    &lt;button&#10;                      class=&quot;btn btn-outline-info&quot;&#10;                      @click=&quot;viewBookDetail(borrow.MaSach)&quot;&#10;                      title=&quot;Xem chi tiết và mượn lại&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-eye&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      v-if=&quot;borrow.TrangThai === 'Chờ duyệt'&quot;&#10;                      class=&quot;btn btn-outline-danger&quot;&#10;                      @click=&quot;cancelBorrowRequest(borrow._id)&quot;&#10;                      title=&quot;Hủy yêu cầu&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-x-circle&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      v-else&#10;                      class=&quot;btn btn-outline-success&quot;&#10;                      @click=&quot;quickBorrow(borrow.MaSach)&quot;&#10;                      title=&quot;Mượn nhanh (1 quyển)&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-plus-circle-fill&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      v-if=&quot;borrow.TrangThai !== 'Chờ duyệt'&quot;&#10;                      class=&quot;btn btn-outline-primary&quot;&#10;                      @click=&quot;borrowAgain(borrow.MaSach)&quot;&#10;                      title=&quot;Mượn lại (tùy chọn số lượng)&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-arrow-repeat&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/td&gt;&#10;              &lt;/tr&gt;&#10;              &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Pagination --&gt;&#10;          &lt;nav aria-label=&quot;Page navigation&quot; v-if=&quot;totalPages &gt; 1&quot;&gt;&#10;            &lt;ul class=&quot;pagination justify-content-center&quot;&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === 1 }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage - 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-left&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li&#10;                class=&quot;page-item&quot;&#10;                v-for=&quot;page in displayPages&quot;&#10;                :key=&quot;page&quot;&#10;                :class=&quot;{ active: currentPage === page }&quot;&#10;              &gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(page)&quot;&gt;{{ page }}&lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === totalPages }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage + 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-right&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;            &lt;/ul&gt;&#10;          &lt;/nav&gt;&#10;&#10;          &lt;!-- Showing info --&gt;&#10;          &lt;div class=&quot;text-center text-muted mb-3&quot;&gt;&#10;            Hiển thị {{ (currentPage - 1) * itemsPerPage + 1 }} -&#10;            {{ Math.min(currentPage * itemsPerPage, sortedActiveBorrows.length) }}&#10;            trong tổng số {{ sortedActiveBorrows.length }} bản ghi&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Summary --&gt;&#10;          &lt;div class=&quot;alert alert-info mt-3&quot;&gt;&#10;            &lt;i class=&quot;bi bi-info-circle me-2&quot;&gt;&lt;/i&gt;&#10;            Tổng số sách đang mượn: &lt;strong&gt;{{ activeBorrows.length }}&lt;/strong&gt; |&#10;            Quá hạn: &lt;strong class=&quot;text-danger&quot;&gt;{{ overdueCount }}&lt;/strong&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- No borrowed books --&gt;&#10;        &lt;div v-else class=&quot;text-center py-5&quot;&gt;&#10;          &lt;i class=&quot;bi bi-bookmark-x fs-1 text-muted&quot;&gt;&lt;/i&gt;&#10;          &lt;p class=&quot;text-muted mt-2&quot;&gt;Bạn chưa mượn sách nào&lt;/p&gt;&#10;          &lt;router-link to=&quot;/docgia/search-books&quot; class=&quot;btn btn-primary&quot;&gt;&#10;            &lt;i class=&quot;bi bi-search me-1&quot;&gt;&lt;/i&gt;&#10;            Tìm sách để mượn&#10;          &lt;/router-link&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;!-- Book Detail Modal --&gt;&#10;    &lt;Transition name=&quot;modal-fade&quot;&gt;&#10;      &lt;div v-if=&quot;showDetailModal&quot; class=&quot;modal-backdrop&quot; @click=&quot;closeDetailModal&quot;&gt;&#10;        &lt;Transition name=&quot;modal-slide&quot;&gt;&#10;          &lt;div v-if=&quot;showDetailModal&quot; class=&quot;modal-dialog-wrapper&quot; @click.stop&gt;&#10;            &lt;div class=&quot;modal-content-custom&quot;&gt;&#10;              &lt;button type=&quot;button&quot; class=&quot;btn-close-custom&quot; @click=&quot;closeDetailModal&quot;&gt;&#10;                &lt;i class=&quot;bi bi-x-lg&quot;&gt;&lt;/i&gt;&#10;              &lt;/button&gt;&#10;&#10;              &lt;div class=&quot;modal-body-custom&quot;&gt;&#10;                &lt;!-- Loading state --&gt;&#10;                &lt;div v-if=&quot;isLoadingBookDetail&quot; class=&quot;book-detail-loading&quot;&gt;&#10;                  &lt;div class=&quot;spinner-border text-primary&quot; role=&quot;status&quot;&gt;&#10;                    &lt;span class=&quot;visually-hidden&quot;&gt;Đang tải...&lt;/span&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;p class=&quot;mt-3&quot;&gt;Đang tải thông tin sách...&lt;/p&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;!-- Book details --&gt;&#10;                &lt;div v-else-if=&quot;selectedBook&quot;&gt;&#10;                  &lt;div class=&quot;book-detail-image&quot;&gt;&#10;                    &lt;img&#10;                      :src=&quot;selectedBook.HinhAnh || 'https://via.placeholder.com/300x400?text=No+Image'&quot;&#10;                      :alt=&quot;selectedBook.TenSach&quot;&#10;                    /&gt;&#10;                  &lt;/div&gt;&#10;&#10;                  &lt;div class=&quot;book-detail-info&quot;&gt;&#10;                    &lt;h4 class=&quot;book-detail-title&quot;&gt;{{ selectedBook.TenSach }}&lt;/h4&gt;&#10;&#10;                    &lt;div class=&quot;book-detail-meta&quot;&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-person-fill me-1&quot;&gt;&lt;/i&gt;Tác giả:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;{{ selectedBook.TacGia }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-calendar-event me-1&quot;&gt;&lt;/i&gt;Năm xuất bản:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;{{ formatYear(selectedBook.NamXuatBan) }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-building me-1&quot;&gt;&lt;/i&gt;Nhà xuất bản:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;{{ getPublisherName(selectedBook.IdNxb) }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-cash me-1&quot;&gt;&lt;/i&gt;Đơn giá:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value text-success fw-bold&quot;&gt;{{ formatPrice(selectedBook.DonGia) }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-book-half me-1&quot;&gt;&lt;/i&gt;Số lượng:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;&#10;                          &lt;span :class=&quot;selectedBook.SoQuyen &gt; 0 ? 'text-success' : 'text-danger'&quot;&gt;&#10;                            {{ selectedBook.SoQuyen }} quyển&#10;                          &lt;/span&gt;&#10;                        &lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-check-circle me-1&quot;&gt;&lt;/i&gt;Tình trạng:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;&#10;                          &lt;span :class=&quot;selectedBook.SoQuyen &gt; 0 ? 'badge bg-success' : 'badge bg-danger'&quot;&gt;&#10;                            {{ selectedBook.SoQuyen &gt; 0 ? 'Còn sách' : 'Hết sách' }}&#10;                          &lt;/span&gt;&#10;                        &lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div class=&quot;modal-footer-custom&quot;&gt;&#10;                &lt;button class=&quot;btn btn-secondary&quot; @click=&quot;closeDetailModal&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;                  Đóng&#10;                &lt;/button&gt;&#10;                &lt;button&#10;                  class=&quot;btn btn-gradient&quot;&#10;                  @click=&quot;borrowFromDetail&quot;&#10;                  :disabled=&quot;isLoadingBookDetail || !selectedBook || selectedBook.SoQuyen === 0&quot;&#10;                &gt;&#10;                  &lt;i class=&quot;bi bi-bookmark-plus me-1&quot;&gt;&lt;/i&gt;&#10;                  Mượn lại&#10;                &lt;/button&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/Transition&gt;&#10;      &lt;/div&gt;&#10;    &lt;/Transition&gt;&#10;&#10;    &lt;!-- Borrow Again Modal --&gt;&#10;    &lt;Transition name=&quot;modal-fade&quot;&gt;&#10;      &lt;div v-if=&quot;showBorrowModal&quot; class=&quot;modal-backdrop&quot; @click=&quot;closeBorrowModal&quot;&gt;&#10;        &lt;Transition name=&quot;modal-slide&quot;&gt;&#10;          &lt;div v-if=&quot;showBorrowModal&quot; class=&quot;modal-dialog-wrapper-small&quot; @click.stop&gt;&#10;            &lt;div class=&quot;modal-content-custom&quot;&gt;&#10;              &lt;button type=&quot;button&quot; class=&quot;btn-close-custom&quot; @click=&quot;closeBorrowModal&quot;&gt;&#10;                &lt;i class=&quot;bi bi-x-lg&quot;&gt;&lt;/i&gt;&#10;              &lt;/button&gt;&#10;&#10;              &lt;div class=&quot;borrow-modal-content&quot;&gt;&#10;                &lt;div class=&quot;borrow-modal-icon&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-arrow-repeat&quot;&gt;&lt;/i&gt;&#10;                &lt;/div&gt;&#10;                &lt;h4 class=&quot;borrow-modal-title&quot;&gt;Mượn lại sách&lt;/h4&gt;&#10;&#10;                &lt;div v-if=&quot;selectedBook&quot; class=&quot;book-info-card&quot;&gt;&#10;                  &lt;h5&gt;{{ selectedBook.TenSach }}&lt;/h5&gt;&#10;                  &lt;p class=&quot;text-muted mb-2&quot;&gt;Tác giả: {{ selectedBook.TacGia }}&lt;/p&gt;&#10;                  &lt;p class=&quot;text-muted mb-0&quot;&gt;Còn lại: {{ selectedBook.SoQuyen }} quyển&lt;/p&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div class=&quot;form-group mb-3&quot;&gt;&#10;                  &lt;label class=&quot;form-label fw-bold&quot;&gt;Số lượng mượn&lt;/label&gt;&#10;                  &lt;input&#10;                    type=&quot;number&quot;&#10;                    v-model=&quot;borrowQuantity&quot;&#10;                    class=&quot;form-control&quot;&#10;                    min=&quot;1&quot;&#10;                    :max=&quot;selectedBook?.SoQuyen || 1&quot;&#10;                  /&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;!-- Alerts --&gt;&#10;                &lt;div v-if=&quot;borrowError&quot; class=&quot;alert alert-danger&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-exclamation-triangle-fill me-2&quot;&gt;&lt;/i&gt;&#10;                  {{ borrowError }}&#10;                &lt;/div&gt;&#10;                &lt;div v-if=&quot;borrowSuccess&quot; class=&quot;alert alert-success&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-check-circle-fill me-2&quot;&gt;&lt;/i&gt;&#10;                  {{ borrowSuccess }}&#10;                &lt;/div&gt;&#10;&#10;                &lt;div class=&quot;borrow-modal-actions&quot;&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot; @click=&quot;closeBorrowModal&quot; :disabled=&quot;isBorrowing&quot;&gt;&#10;                    &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;                    Hủy&#10;                  &lt;/button&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; @click=&quot;confirmBorrowAgain&quot; :disabled=&quot;isBorrowing&quot;&gt;&#10;                    &lt;span v-if=&quot;isBorrowing&quot;&gt;&#10;                      &lt;span class=&quot;spinner-border spinner-border-sm me-2&quot;&gt;&lt;/span&gt;&#10;                      Đang xử lý...&#10;                    &lt;/span&gt;&#10;                    &lt;span v-else&gt;&#10;                      &lt;i class=&quot;bi bi-check-lg me-1&quot;&gt;&lt;/i&gt;&#10;                      Xác nhận mượn&#10;                    &lt;/span&gt;&#10;                  &lt;/button&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/Transition&gt;&#10;      &lt;/div&gt;&#10;    &lt;/Transition&gt;&#10;&#10;    &lt;!-- Login Prompt Modal --&gt;&#10;    &lt;Transition name=&quot;modal-fade&quot;&gt;&#10;      &lt;div v-if=&quot;showLoginPrompt&quot; class=&quot;modal-backdrop&quot; @click=&quot;closeLoginPrompt&quot;&gt;&#10;        &lt;Transition name=&quot;modal-slide&quot;&gt;&#10;          &lt;div v-if=&quot;showLoginPrompt&quot; class=&quot;modal-dialog-wrapper-small&quot; @click.stop&gt;&#10;            &lt;div class=&quot;modal-content-custom&quot;&gt;&#10;              &lt;button type=&quot;button&quot; class=&quot;btn-close-custom&quot; @click=&quot;closeLoginPrompt&quot;&gt;&#10;                &lt;i class=&quot;bi bi-x-lg&quot;&gt;&lt;/i&gt;&#10;              &lt;/button&gt;&#10;&#10;              &lt;div class=&quot;login-prompt-content&quot;&gt;&#10;                &lt;div class=&quot;login-prompt-icon&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-lock-fill&quot;&gt;&lt;/i&gt;&#10;                &lt;/div&gt;&#10;                &lt;h4 class=&quot;login-prompt-title&quot;&gt;Phiên đăng nhập hết hạn&lt;/h4&gt;&#10;                &lt;p class=&quot;login-prompt-message&quot;&gt;&#10;                  Phiên đăng nhập của bạn đã hết hạn. Vui lòng đăng nhập lại để tiếp tục mượn sách.&#10;                &lt;/p&gt;&#10;&#10;                &lt;div class=&quot;login-prompt-actions&quot;&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot; @click=&quot;closeLoginPrompt&quot;&gt;&#10;                    &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;                    Hủy&#10;                  &lt;/button&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; @click=&quot;redirectToLogin&quot;&gt;&#10;                    &lt;i class=&quot;bi bi-box-arrow-in-right me-1&quot;&gt;&lt;/i&gt;&#10;                    Đăng nhập&#10;                  &lt;/button&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/Transition&gt;&#10;      &lt;/div&gt;&#10;    &lt;/Transition&gt;&#10;  &lt;/div&gt;&#10;&lt;/template&gt;&#10;&#10;&lt;script setup lang=&quot;ts&quot;&gt;&#10;import {ref, onMounted, computed} from 'vue'&#10;import {useRouter} from 'vue-router'&#10;import {bookService} from '../../services/bookService'&#10;import {authService} from '../../services/authService'&#10;import type {TheoDoiMuonSach, Sach} from '../../types/book'&#10;import {TrangThaiMuonSach, TrangThaiMuonSachLabel} from '../../types/book'&#10;&#10;const router = useRouter()&#10;const borrows = ref&lt;TheoDoiMuonSach[]&gt;([])&#10;const isLoading = ref(false)&#10;const errorMessage = ref('')&#10;&#10;// Search, filter, sort states&#10;const searchQuery = ref('')&#10;const statusFilter = ref&lt;string&gt;('all')&#10;const sortBy = ref('date_desc')&#10;&#10;// Pagination states&#10;const currentPage = ref(1)&#10;const itemsPerPage = ref(10)&#10;&#10;// Modal states&#10;const showDetailModal = ref(false)&#10;const showBorrowModal = ref(false)&#10;const showLoginPrompt = ref(false)&#10;const selectedBook = ref&lt;Sach | null&gt;(null)&#10;const borrowQuantity = ref(1)&#10;const isBorrowing = ref(false)&#10;const borrowError = ref('')&#10;const borrowSuccess = ref('')&#10;const isLoadingBookDetail = ref(false)&#10;&#10;// Filter only active borrows (not returned yet)&#10;const activeBorrows = computed(() =&gt; {&#10;  let result = borrows.value.filter(b =&gt; b.TrangThai !== TrangThaiMuonSach.DA_TRA)&#10;&#10;  // Search filter&#10;  if (searchQuery.value.trim()) {&#10;    const query = searchQuery.value.toLowerCase()&#10;    result = result.filter(b =&gt;&#10;      getBookTitle(b.MaSach).toLowerCase().includes(query) ||&#10;      getBookAuthor(b.MaSach).toLowerCase().includes(query)&#10;    )&#10;  }&#10;&#10;  // Status filter&#10;  if (statusFilter.value !== 'all') {&#10;    console.log('Filtering by status:', statusFilter.value)&#10;    console.log('Sample book status:', result[0]?.TrangThai)&#10;    result = result.filter(b =&gt; {&#10;      const match = b.TrangThai === statusFilter.value&#10;      if (!match) {&#10;        console.log(`No match: &quot;${b.TrangThai}&quot; !== &quot;${statusFilter.value}&quot;`)&#10;      }&#10;      return match&#10;    })&#10;    console.log('Filtered result count:', result.length)&#10;  }&#10;&#10;  return result&#10;})&#10;&#10;const sortedActiveBorrows = computed(() =&gt; {&#10;  const sorted = [...activeBorrows.value]&#10;&#10;  switch (sortBy.value) {&#10;    case 'date_asc':&#10;      return sorted.sort((a, b) =&gt; new Date(a.NgayMuon).getTime() - new Date(b.NgayMuon).getTime())&#10;    case 'date_desc':&#10;      return sorted.sort((a, b) =&gt; new Date(b.NgayMuon).getTime() - new Date(a.NgayMuon).getTime())&#10;    case 'due_date_asc':&#10;      return sorted.sort((a, b) =&gt; new Date(a.NgayTra).getTime() - new Date(b.NgayTra).getTime())&#10;    case 'name_asc':&#10;      return sorted.sort((a, b) =&gt; getBookTitle(a.MaSach).localeCompare(getBookTitle(b.MaSach)))&#10;    default:&#10;      return sorted&#10;  }&#10;})&#10;&#10;const totalPages = computed(() =&gt; {&#10;  return Math.ceil(sortedActiveBorrows.value.length / itemsPerPage.value)&#10;})&#10;&#10;const paginatedBorrows = computed(() =&gt; {&#10;  const start = (currentPage.value - 1) * itemsPerPage.value&#10;  const end = start + itemsPerPage.value&#10;  return sortedActiveBorrows.value.slice(start, end)&#10;})&#10;&#10;const displayPages = computed(() =&gt; {&#10;  const pages = []&#10;  const maxDisplay = 5&#10;  let startPage = Math.max(1, currentPage.value - Math.floor(maxDisplay / 2))&#10;  let endPage = Math.min(totalPages.value, startPage + maxDisplay - 1)&#10;&#10;  if (endPage - startPage &lt; maxDisplay - 1) {&#10;    startPage = Math.max(1, endPage - maxDisplay + 1)&#10;  }&#10;&#10;  for (let i = startPage; i &lt;= endPage; i++) {&#10;    pages.push(i)&#10;  }&#10;&#10;  return pages&#10;})&#10;&#10;const overdueCount = computed(() =&gt; {&#10;  return activeBorrows.value.filter(b =&gt; isOverdue(b.NgayTra)).length&#10;})&#10;&#10;const loadBorrowedBooks = async () =&gt; {&#10;  isLoading.value = true&#10;  errorMessage.value = ''&#10;&#10;  const userIdFromStorage = localStorage.getItem('userId')&#10;&#10;  if (!userIdFromStorage) {&#10;    errorMessage.value = 'Không tìm thấy thông tin người dùng'&#10;    isLoading.value = false&#10;    return&#10;  }&#10;&#10;  try {&#10;    borrows.value = await bookService.getMyBorrowedBooks(userIdFromStorage)&#10;&#10;    borrows.value = borrows.value.sort((a, b) =&gt; a.TrangThai.localeCompare(b.TrangThai))&#10;  } catch (error: any) {&#10;    errorMessage.value = error.message || 'Bạn chưa mượn sách nào'&#10;  } finally {&#10;    isLoading.value = false&#10;  }&#10;}&#10;&#10;const getBookTitle = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TenSach) {&#10;    return maSach.TenSach&#10;  }&#10;  return 'Đang tải...'&#10;}&#10;&#10;const getBookAuthor = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TacGia) {&#10;    return maSach.TacGia&#10;  }&#10;  return '-'&#10;}&#10;&#10;const formatDate = (date: string): string =&gt; {&#10;  return new Date(date).toLocaleDateString('vi-VN')&#10;}&#10;&#10;const formatPrice = (price: number): string =&gt; {&#10;  return new Intl.NumberFormat('vi-VN', {style: 'currency', currency: 'VND'}).format(price)&#10;}&#10;&#10;const isOverdue = (ngayTra: string): boolean =&gt; {&#10;  return new Date(ngayTra) &lt; new Date()&#10;}&#10;&#10;const getStatusClass = (status: TrangThaiMuonSach): string =&gt; {&#10;  switch (status) {&#10;    case TrangThaiMuonSach.CHO_DUYET:&#10;      return 'badge bg-warning'&#10;    case TrangThaiMuonSach.DA_DUYET:&#10;      return 'badge bg-success'&#10;    case TrangThaiMuonSach.DA_TRA:&#10;      return 'badge bg-secondary'&#10;    default:&#10;      return 'badge bg-light text-dark'&#10;  }&#10;}&#10;&#10;const formatYear = (date: string | Date): string =&gt; {&#10;  return new Date(date).getFullYear().toString()&#10;}&#10;&#10;const getPublisherName = (publisher: any): string =&gt; {&#10;  if (typeof publisher === 'object' &amp;&amp; publisher?.TenNXB) {&#10;    return publisher.TenNXB&#10;  }&#10;  return 'Đang tải...'&#10;}&#10;&#10;const getBook = (maSach: string | Sach): Sach | null =&gt; {&#10;  if (typeof maSach === 'object') {&#10;    return maSach&#10;  }&#10;  return null&#10;}&#10;&#10;// View book detail&#10;const viewBookDetail = async (maSach: string | Sach) =&gt; {&#10;  const book = getBook(maSach)&#10;  if (!book) {&#10;    return&#10;  }&#10;&#10;  isLoadingBookDetail.value = true&#10;  showDetailModal.value = true&#10;&#10;  try {&#10;    // Fetch latest book data from API to get current stock quantity&#10;    const latestBookData = await bookService.getBookById(book._id)&#10;    selectedBook.value = latestBookData&#10;  } catch (error: any) {&#10;    // If API fails, fallback to cached data&#10;    console.error('Failed to fetch latest book data:', error)&#10;    selectedBook.value = book&#10;  } finally {&#10;    isLoadingBookDetail.value = false&#10;  }&#10;}&#10;&#10;const closeDetailModal = () =&gt; {&#10;  showDetailModal.value = false&#10;}&#10;&#10;const borrowFromDetail = () =&gt; {&#10;  closeDetailModal()&#10;  if (selectedBook.value) {&#10;    borrowAgain(selectedBook.value)&#10;  }&#10;}&#10;&#10;// Quick borrow - instantly borrow 1 copy without modal&#10;const quickBorrow = async (maSach: string | Sach) =&gt; {&#10;  // Check if user is logged in&#10;  if (!authService.isAuthenticated()) {&#10;    showLoginPrompt.value = true&#10;    return&#10;  }&#10;&#10;  const book = getBook(maSach)&#10;  if (!book) {&#10;    return&#10;  }&#10;&#10;  // Confirm quick borrow&#10;  const bookTitle = getBookTitle(maSach)&#10;  if (!confirm(`Mượn nhanh &quot;${bookTitle}&quot; (1 quyển)?`)) {&#10;    return&#10;  }&#10;&#10;  try {&#10;    // Fetch latest book data to check current availability&#10;    const latestBookData = await bookService.getBookById(book._id)&#10;&#10;    // Check if book is available&#10;    if (latestBookData.SoQuyen === 0) {&#10;      alert('Sách hiện không còn để mượn')&#10;      return&#10;    }&#10;&#10;    // Show loading state&#10;    isBorrowing.value = true&#10;&#10;    // Submit borrow request with quantity 1&#10;    const userId = localStorage.getItem('userId')&#10;    if (!userId) {&#10;      alert('Không tìm thấy thông tin người dùng')&#10;      return&#10;    }&#10;&#10;    await bookService.borrowBook({&#10;      MaSach: latestBookData._id,&#10;      SoQuyen: 1&#10;    })&#10;&#10;    alert('✅ Yêu cầu mượn sách thành công! Chờ nhân viên duyệt.')&#10;&#10;    // Reload the borrowed books list&#10;    await loadBorrowedBooks()&#10;  } catch (error: any) {&#10;    alert(error.message || 'Không thể mượn sách. Vui lòng thử lại.')&#10;  } finally {&#10;    isBorrowing.value = false&#10;  }&#10;}&#10;&#10;// Borrow again functionality&#10;const borrowAgain = async (maSach: string | Sach) =&gt; {&#10;  // Check if user is logged in&#10;  if (!authService.isAuthenticated()) {&#10;    showLoginPrompt.value = true&#10;    return&#10;  }&#10;&#10;  const book = getBook(maSach)&#10;  if (!book) {&#10;    return&#10;  }&#10;&#10;  try {&#10;    // Fetch latest book data to check current availability&#10;    const latestBookData = await bookService.getBookById(book._id)&#10;&#10;    // Check if book is available&#10;    if (latestBookData.SoQuyen === 0) {&#10;      alert('Sách hiện không còn để mượn')&#10;      return&#10;    }&#10;&#10;    selectedBook.value = latestBookData&#10;    borrowQuantity.value = 1&#10;    borrowError.value = ''&#10;    borrowSuccess.value = ''&#10;    showBorrowModal.value = true&#10;  } catch (error: any) {&#10;    alert('Không thể tải thông tin sách. Vui lòng thử lại.')&#10;  }&#10;}&#10;&#10;const closeBorrowModal = () =&gt; {&#10;  showBorrowModal.value = false&#10;  borrowError.value = ''&#10;  borrowSuccess.value = ''&#10;}&#10;&#10;const confirmBorrowAgain = async () =&gt; {&#10;  if (!selectedBook.value) return&#10;&#10;  borrowError.value = ''&#10;  borrowSuccess.value = ''&#10;  isBorrowing.value = true&#10;&#10;  try {&#10;    const userId = localStorage.getItem('userId')&#10;    if (!userId) {&#10;      borrowError.value = 'Không tìm thấy thông tin người dùng'&#10;      return&#10;    }&#10;&#10;    await bookService.borrowBook({&#10;      MaSach: selectedBook.value._id,&#10;      SoQuyen: borrowQuantity.value&#10;    })&#10;&#10;    borrowSuccess.value = 'Yêu cầu mượn sách thành công!'&#10;&#10;    setTimeout(() =&gt; {&#10;      closeBorrowModal()&#10;      loadBorrowedBooks() // Reload the list&#10;    }, 1500)&#10;  } catch (error: any) {&#10;    borrowError.value = error.message || 'Không thể mượn sách. Vui lòng thử lại.'&#10;  } finally {&#10;    isBorrowing.value = false&#10;  }&#10;}&#10;&#10;// Login prompt handlers&#10;const closeLoginPrompt = () =&gt; {&#10;  showLoginPrompt.value = false&#10;}&#10;&#10;const redirectToLogin = () =&gt; {&#10;  showLoginPrompt.value = false&#10;  router.push('/auth/login')&#10;}&#10;&#10;// Pagination handler&#10;const changePage = (page: number) =&gt; {&#10;  if (page &gt;= 1 &amp;&amp; page &lt;= totalPages.value) {&#10;    currentPage.value = page&#10;  }&#10;}&#10;&#10;// Cancel borrow request&#10;const cancelBorrowRequest = async (borrowId: string) =&gt; {&#10;  if (!confirm('Bạn có chắc chắn muốn hủy yêu cầu mượn sách này?')) {&#10;    return&#10;  }&#10;&#10;  try {&#10;    // Call the delete API to cancel the request&#10;    await bookService.cancelBorrowRequest(borrowId)&#10;    alert('Đã hủy yêu cầu mượn sách thành công')&#10;    await loadBorrowedBooks() // Reload the list&#10;  } catch (error: any) {&#10;    alert(error.message || 'Không thể hủy yêu cầu. Vui lòng thử lại.')&#10;  }&#10;}&#10;&#10;onMounted(() =&gt; {&#10;  loadBorrowedBooks()&#10;})&#10;&lt;/script&gt;&#10;&#10;&lt;style scoped&gt;&#10;.table-responsive {&#10;  border-radius: 8px;&#10;}&#10;&#10;.btn-group-sm .btn {&#10;  padding: 0.25rem 0.5rem;&#10;  font-size: 0.875rem;&#10;}&#10;&#10;/* Quick borrow button styling */&#10;.btn-outline-success {&#10;  transition: all 0.3s ease;&#10;}&#10;&#10;.btn-outline-success:hover:not(:disabled) {&#10;  background: linear-gradient(135deg, #10b981 0%, #059669 100%);&#10;  border-color: #10b981;&#10;  transform: translateY(-1px);&#10;  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);&#10;}&#10;&#10;.btn-outline-success i {&#10;  animation: pulse 2s infinite;&#10;}&#10;&#10;@keyframes pulse {&#10;  0%, 100% {&#10;    transform: scale(1);&#10;  }&#10;  50% {&#10;    transform: scale(1.1);&#10;  }&#10;}&#10;&#10;/* Modal Backdrop */&#10;.modal-backdrop {&#10;  position: fixed;&#10;  top: 0;&#10;  left: 0;&#10;  width: 100%;&#10;  height: 100%;&#10;  background: rgba(0, 0, 0, 0.7);&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  z-index: 9999;&#10;  padding: 1rem;&#10;}&#10;&#10;/* Modal Dialog Wrapper */&#10;.modal-dialog-wrapper {&#10;  max-width: 700px;&#10;  width: 100%;&#10;  max-height: 90vh;&#10;  overflow-y: auto;&#10;}&#10;&#10;.modal-dialog-wrapper-small {&#10;  max-width: 450px;&#10;  width: 100%;&#10;}&#10;&#10;/* Modal Content */&#10;.modal-content-custom {&#10;  background: white;&#10;  border-radius: 16px;&#10;  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);&#10;  position: relative;&#10;  overflow: hidden;&#10;}&#10;&#10;/* Close Button */&#10;.btn-close-custom {&#10;  position: absolute;&#10;  top: 1rem;&#10;  right: 1rem;&#10;  z-index: 10;&#10;  background: rgba(255, 255, 255, 0.9);&#10;  border: none;&#10;  border-radius: 50%;&#10;  width: 36px;&#10;  height: 36px;&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  cursor: pointer;&#10;  transition: all 0.2s;&#10;}&#10;&#10;.btn-close-custom:hover {&#10;  background: white;&#10;  transform: rotate(90deg);&#10;}&#10;&#10;.btn-close-custom i {&#10;  font-size: 1.2rem;&#10;  color: #333;&#10;}&#10;&#10;/* Modal Body */&#10;.modal-body-custom {&#10;  padding: 0;&#10;}&#10;&#10;/* Book Detail Image */&#10;.book-detail-image {&#10;  width: 100%;&#10;  height: 300px;&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;}&#10;&#10;.book-detail-image img {&#10;  height: 100%;&#10;  max-width: 100%;&#10;  object-fit: contain;&#10;}&#10;&#10;/* Book Detail Loading */&#10;.book-detail-loading {&#10;  padding: 4rem 2rem;&#10;  text-align: center;&#10;  min-height: 300px;&#10;  display: flex;&#10;  flex-direction: column;&#10;  align-items: center;&#10;  justify-content: center;&#10;}&#10;&#10;.book-detail-loading p {&#10;  color: #4a5568;&#10;  font-size: 1rem;&#10;  margin: 0;&#10;}&#10;&#10;/* Book Detail Info */&#10;.book-detail-info {&#10;  padding: 2rem;&#10;}&#10;&#10;.book-detail-title {&#10;  font-size: 1.75rem;&#10;  font-weight: 700;&#10;  color: #2d3748;&#10;  margin-bottom: 1.5rem;&#10;}&#10;&#10;.book-detail-meta {&#10;  display: flex;&#10;  flex-direction: column;&#10;  gap: 1rem;&#10;}&#10;&#10;.meta-row {&#10;  display: flex;&#10;  align-items: center;&#10;  padding: 0.75rem 0;&#10;  border-bottom: 1px solid #e2e8f0;&#10;}&#10;&#10;.meta-row:last-child {&#10;  border-bottom: none;&#10;}&#10;&#10;.meta-label {&#10;  min-width: 150px;&#10;  font-weight: 600;&#10;  color: #4a5568;&#10;  display: flex;&#10;  align-items: center;&#10;}&#10;&#10;.meta-value {&#10;  color: #2d3748;&#10;  font-weight: 500;&#10;}&#10;&#10;/* Modal Footer */&#10;.modal-footer-custom {&#10;  padding: 1.5rem 2rem;&#10;  background: #f7fafc;&#10;  display: flex;&#10;  gap: 1rem;&#10;  justify-content: flex-end;&#10;}&#10;&#10;.modal-footer-custom .btn {&#10;  padding: 0.75rem 1.5rem;&#10;  font-weight: 600;&#10;  border-radius: 8px;&#10;}&#10;&#10;/* Borrow Modal Content */&#10;.borrow-modal-content {&#10;  padding: 3rem 2rem;&#10;  text-align: center;&#10;}&#10;&#10;.borrow-modal-icon {&#10;  width: 80px;&#10;  height: 80px;&#10;  margin: 0 auto 1.5rem;&#10;  background: linear-gradient(135deg, #10b981 0%, #059669 100%);&#10;  border-radius: 50%;&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);&#10;}&#10;&#10;.borrow-modal-icon i {&#10;  font-size: 2.5rem;&#10;  color: white;&#10;}&#10;&#10;.borrow-modal-title {&#10;  font-size: 1.75rem;&#10;  font-weight: 700;&#10;  color: #2d3748;&#10;  margin-bottom: 1.5rem;&#10;}&#10;&#10;.book-info-card {&#10;  background: #f7fafc;&#10;  padding: 1.5rem;&#10;  border-radius: 12px;&#10;  margin-bottom: 1.5rem;&#10;  text-align: left;&#10;}&#10;&#10;.book-info-card h5 {&#10;  color: #2d3748;&#10;  font-weight: 700;&#10;  margin-bottom: 0.5rem;&#10;}&#10;&#10;.form-group {&#10;  text-align: left;&#10;}&#10;&#10;.form-label {&#10;  color: #4a5568;&#10;  margin-bottom: 0.5rem;&#10;}&#10;&#10;.form-control {&#10;  border-radius: 8px;&#10;  border: 1px solid #d2d6da;&#10;  padding: 0.75rem;&#10;  font-size: 1rem;&#10;}&#10;&#10;.form-control:focus {&#10;  border-color: #667eea;&#10;  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);&#10;}&#10;&#10;.borrow-modal-actions {&#10;  display: flex;&#10;  gap: 1rem;&#10;  justify-content: center;&#10;  margin-top: 1.5rem;&#10;}&#10;&#10;.borrow-modal-actions .btn {&#10;  padding: 0.75rem 1.5rem;&#10;  font-weight: 600;&#10;  border-radius: 8px;&#10;  transition: all 0.3s;&#10;}&#10;&#10;.borrow-modal-actions .btn-secondary {&#10;  background: #e2e8f0;&#10;  border: none;&#10;  color: #4a5568;&#10;}&#10;&#10;.borrow-modal-actions .btn-secondary:hover {&#10;  background: #cbd5e0;&#10;  transform: translateY(-2px);&#10;}&#10;&#10;.borrow-modal-actions .btn-primary {&#10;  background: linear-gradient(135deg, #10b981 0%, #059669 100%);&#10;  border: none;&#10;}&#10;&#10;.borrow-modal-actions .btn-primary:hover:not(:disabled) {&#10;  transform: translateY(-2px);&#10;  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);&#10;}&#10;&#10;/* Login Prompt Modal */&#10;.login-prompt-content {&#10;  padding: 3rem 2rem;&#10;  text-align: center;&#10;}&#10;&#10;.login-prompt-icon {&#10;  width: 80px;&#10;  height: 80px;&#10;  margin: 0 auto 1.5rem;&#10;  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);&#10;  border-radius: 50%;&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);&#10;}&#10;&#10;.login-prompt-icon i {&#10;  font-size: 2.5rem;&#10;  color: white;&#10;}&#10;&#10;.login-prompt-title {&#10;  font-size: 1.75rem;&#10;  font-weight: 700;&#10;  color: #2d3748;&#10;  margin-bottom: 1rem;&#10;}&#10;&#10;.login-prompt-message {&#10;  color: #4a5568;&#10;  font-size: 1.05rem;&#10;  margin-bottom: 2rem;&#10;  line-height: 1.6;&#10;}&#10;&#10;.login-prompt-actions {&#10;  display: flex;&#10;  gap: 1rem;&#10;  justify-content: center;&#10;}&#10;&#10;.login-prompt-actions .btn {&#10;  padding: 0.75rem 1.5rem;&#10;  font-weight: 600;&#10;  border-radius: 8px;&#10;  transition: all 0.3s;&#10;}&#10;&#10;.login-prompt-actions .btn-secondary {&#10;  background: #e2e8f0;&#10;  border: none;&#10;  color: #4a5568;&#10;}&#10;&#10;.login-prompt-actions .btn-secondary:hover {&#10;  background: #cbd5e0;&#10;  transform: translateY(-2px);&#10;}&#10;&#10;.login-prompt-actions .btn-primary {&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;  border: none;&#10;}&#10;&#10;.login-prompt-actions .btn-primary:hover {&#10;  transform: translateY(-2px);&#10;  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);&#10;}&#10;&#10;/* Alerts */&#10;.alert {&#10;  border-radius: 8px;&#10;  border: none;&#10;  padding: 1rem;&#10;  margin-bottom: 1rem;&#10;}&#10;&#10;/* Modal Transitions */&#10;.modal-fade-enter-active,&#10;.modal-fade-leave-active {&#10;  transition: opacity 0.3s ease;&#10;}&#10;&#10;.modal-fade-enter-from,&#10;.modal-fade-leave-to {&#10;  opacity: 0;&#10;}&#10;&#10;.modal-slide-enter-active,&#10;.modal-slide-leave-active {&#10;  transition: all 0.3s ease;&#10;}&#10;&#10;.modal-slide-enter-from {&#10;  transform: translateY(-50px);&#10;  opacity: 0;&#10;}&#10;&#10;.modal-slide-leave-to {&#10;  transform: translateY(50px);&#10;  opacity: 0;&#10;}&#10;&#10;.btn-gradient {&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;  border: none;&#10;  color: white;&#10;  transition: all 0.3s;&#10;}&#10;&#10;.btn-gradient:hover:not(:disabled) {&#10;  transform: translateY(-2px);&#10;  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);&#10;}&#10;&#10;/* Responsive */&#10;@media (max-width: 768px) {&#10;  .modal-dialog-wrapper,&#10;  .modal-dialog-wrapper-small {&#10;    max-width: 95%;&#10;  }&#10;&#10;  .book-detail-image {&#10;    height: 250px;&#10;  }&#10;&#10;  .book-detail-info {&#10;    padding: 1.5rem;&#10;  }&#10;&#10;  .book-detail-title {&#10;    font-size: 1.5rem;&#10;  }&#10;&#10;  .meta-label {&#10;    min-width: 100px;&#10;    font-size: 0.9rem;&#10;  }&#10;&#10;  .modal-footer-custom,&#10;  .borrow-modal-actions,&#10;  .login-prompt-actions {&#10;    flex-direction: column;&#10;  }&#10;&#10;  .borrow-modal-content,&#10;  .login-prompt-content {&#10;    padding: 2rem 1.5rem;&#10;  }&#10;&#10;  .borrow-modal-title,&#10;  .login-prompt-title {&#10;    font-size: 1.5rem;&#10;  }&#10;&#10;  .login-prompt-message {&#10;    font-size: 1rem;&#10;  }&#10;}&#10;&lt;/style&gt;&#10;" />
              <option name="updatedContent" value="&lt;template&gt;&#10;  &lt;div class=&quot;container-fluid px-4 mt-4&quot;&gt;&#10;    &lt;div class=&quot;card shadow&quot;&gt;&#10;      &lt;div class=&quot;card-header btn-gradient text-white&quot;&gt;&#10;        &lt;h4 class=&quot;mb-0&quot;&gt;&#10;          &lt;i class=&quot;bi bi-bookmark-check me-2&quot;&gt;&lt;/i&gt;&#10;          Sách đã mượn&#10;        &lt;/h4&gt;&#10;      &lt;/div&gt;&#10;      &lt;div class=&quot;card-body&quot;&gt;&#10;        &lt;!-- Search and Filter Section --&gt;&#10;        &lt;div class=&quot;row mb-3&quot;&gt;&#10;          &lt;div class=&quot;col-md-6&quot;&gt;&#10;            &lt;div class=&quot;input-group&quot;&gt;&#10;              &lt;span class=&quot;input-group-text&quot;&gt;&#10;                &lt;i class=&quot;bi bi-search&quot;&gt;&lt;/i&gt;&#10;              &lt;/span&gt;&#10;              &lt;input&#10;                type=&quot;text&quot;&#10;                class=&quot;form-control&quot;&#10;                placeholder=&quot;Tìm theo tên sách hoặc tác giả...&quot;&#10;                v-model=&quot;searchQuery&quot;&#10;              /&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;select class=&quot;form-select&quot; v-model=&quot;statusFilter&quot;&gt;&#10;              &lt;option value=&quot;all&quot;&gt;Tất cả trạng thái&lt;/option&gt;&#10;              &lt;option value=&quot;CHO_DUYET&quot;&gt;Chờ duyệt&lt;/option&gt;&#10;              &lt;option value=&quot;DA_DUYET&quot;&gt;Đã duyệt&lt;/option&gt;&#10;              &lt;option value=&quot;DA_TRA&quot;&gt;Đã trả&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div class=&quot;col-md-3&quot;&gt;&#10;            &lt;select class=&quot;form-select&quot; v-model=&quot;sortBy&quot;&gt;&#10;              &lt;option value=&quot;date_desc&quot;&gt;Ngày mượn (Mới nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;date_asc&quot;&gt;Ngày mượn (Cũ nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;due_date_asc&quot;&gt;Hạn trả (Gần nhất)&lt;/option&gt;&#10;              &lt;option value=&quot;name_asc&quot;&gt;Tên sách (A-Z)&lt;/option&gt;&#10;            &lt;/select&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Loading state --&gt;&#10;        &lt;div v-if=&quot;isLoading&quot; class=&quot;text-center py-5&quot;&gt;&#10;          &lt;div class=&quot;spinner-border text-success&quot; role=&quot;status&quot;&gt;&#10;            &lt;span class=&quot;visually-hidden&quot;&gt;Đang tải...&lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;p class=&quot;mt-2&quot;&gt;Đang tải danh sách sách đã mượn...&lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Error message --&gt;&#10;        &lt;div v-else-if=&quot;errorMessage&quot; class=&quot;alert alert-warning&quot;&gt;&#10;          &lt;i class=&quot;bi bi-info-circle me-2&quot;&gt;&lt;/i&gt;&#10;          {{ errorMessage }}&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Borrowed books list --&gt;&#10;        &lt;div v-else-if=&quot;paginatedBorrows.length &gt; 0&quot;&gt;&#10;          &lt;div class=&quot;table-responsive&quot;&gt;&#10;            &lt;table class=&quot;table table-hover&quot;&gt;&#10;              &lt;thead&gt;&#10;              &lt;tr&gt;&#10;                &lt;th&gt;Tên sách&lt;/th&gt;&#10;                &lt;th&gt;Tác giả&lt;/th&gt;&#10;                &lt;th&gt;Số lượng&lt;/th&gt;&#10;                &lt;th&gt;Ngày mượn&lt;/th&gt;&#10;                &lt;th&gt;Hạn trả&lt;/th&gt;&#10;                &lt;th&gt;Trạng thái&lt;/th&gt;&#10;                &lt;th&gt;Phạt&lt;/th&gt;&#10;                &lt;th class=&quot;text-center&quot;&gt;Thao tác&lt;/th&gt;&#10;              &lt;/tr&gt;&#10;              &lt;/thead&gt;&#10;              &lt;tbody&gt;&#10;              &lt;tr v-for=&quot;borrow in paginatedBorrows&quot; :key=&quot;borrow._id&quot;&gt;&#10;                &lt;td&gt;&#10;                  &lt;strong&gt;{{ getBookTitle(borrow.MaSach) }}&lt;/strong&gt;&#10;                &lt;/td&gt;&#10;                &lt;td&gt;{{ getBookAuthor(borrow.MaSach) }}&lt;/td&gt;&#10;                &lt;td&gt;{{ borrow.SoQuyen }}&lt;/td&gt;&#10;                &lt;td&gt;{{ formatDate(borrow.NgayMuon) }}&lt;/td&gt;&#10;                &lt;td&gt;&#10;                    &lt;span :class=&quot;isOverdue(borrow.NgayTra) ? 'text-danger fw-bold' : ''&quot;&gt;&#10;                      {{ formatDate(borrow.NgayTra) }}&#10;                    &lt;/span&gt;&#10;                &lt;/td&gt;&#10;                &lt;td&gt;&#10;                    &lt;span :class=&quot;getStatusClass(borrow.TrangThai)&quot;&gt;&#10;                      {{ getStatusLabel(borrow.TrangThai) }}&#10;                    &lt;/span&gt;&#10;                &lt;/td&gt;&#10;                &lt;td&gt;&#10;                    &lt;span v-if=&quot;borrow.PhatQuaHan.SoTienPhat &gt; 0&quot; class=&quot;text-danger&quot;&gt;&#10;                      {{ formatPrice(borrow.PhatQuaHan.SoTienPhat) }}&#10;                    &lt;/span&gt;&#10;                  &lt;span v-else class=&quot;text-muted&quot;&gt;-&lt;/span&gt;&#10;                &lt;/td&gt;&#10;                &lt;td class=&quot;text-center&quot;&gt;&#10;                  &lt;div class=&quot;btn-group btn-group-sm&quot;&gt;&#10;                    &lt;button&#10;                      class=&quot;btn btn-outline-info&quot;&#10;                      @click=&quot;viewBookDetail(borrow.MaSach)&quot;&#10;                      title=&quot;Xem chi tiết và mượn lại&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-eye&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      v-if=&quot;borrow.TrangThai === TrangThaiMuonSach.CHO_DUYET&quot;&#10;                      class=&quot;btn btn-outline-danger&quot;&#10;                      @click=&quot;cancelBorrowRequest(borrow._id)&quot;&#10;                      title=&quot;Hủy yêu cầu&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-x-circle&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      v-else&#10;                      class=&quot;btn btn-outline-success&quot;&#10;                      @click=&quot;quickBorrow(borrow.MaSach)&quot;&#10;                      title=&quot;Mượn nhanh (1 quyển)&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-plus-circle-fill&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      v-if=&quot;borrow.TrangThai !== TrangThaiMuonSach.CHO_DUYET&quot;&#10;                      class=&quot;btn btn-outline-primary&quot;&#10;                      @click=&quot;borrowAgain(borrow.MaSach)&quot;&#10;                      title=&quot;Mượn lại (tùy chọn số lượng)&quot;&#10;                    &gt;&#10;                      &lt;i class=&quot;bi bi-arrow-repeat&quot;&gt;&lt;/i&gt;&#10;                    &lt;/button&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/td&gt;&#10;              &lt;/tr&gt;&#10;              &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Pagination --&gt;&#10;          &lt;nav aria-label=&quot;Page navigation&quot; v-if=&quot;totalPages &gt; 1&quot;&gt;&#10;            &lt;ul class=&quot;pagination justify-content-center&quot;&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === 1 }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage - 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-left&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li&#10;                class=&quot;page-item&quot;&#10;                v-for=&quot;page in displayPages&quot;&#10;                :key=&quot;page&quot;&#10;                :class=&quot;{ active: currentPage === page }&quot;&#10;              &gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(page)&quot;&gt;{{ page }}&lt;/a&gt;&#10;              &lt;/li&gt;&#10;              &lt;li class=&quot;page-item&quot; :class=&quot;{ disabled: currentPage === totalPages }&quot;&gt;&#10;                &lt;a class=&quot;page-link&quot; href=&quot;#&quot; @click.prevent=&quot;changePage(currentPage + 1)&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-chevron-right&quot;&gt;&lt;/i&gt;&#10;                &lt;/a&gt;&#10;              &lt;/li&gt;&#10;            &lt;/ul&gt;&#10;          &lt;/nav&gt;&#10;&#10;          &lt;!-- Showing info --&gt;&#10;          &lt;div class=&quot;text-center text-muted mb-3&quot;&gt;&#10;            Hiển thị {{ (currentPage - 1) * itemsPerPage + 1 }} -&#10;            {{ Math.min(currentPage * itemsPerPage, sortedActiveBorrows.length) }}&#10;            trong tổng số {{ sortedActiveBorrows.length }} bản ghi&#10;          &lt;/div&gt;&#10;&#10;          &lt;!-- Summary --&gt;&#10;          &lt;div class=&quot;alert alert-info mt-3&quot;&gt;&#10;            &lt;i class=&quot;bi bi-info-circle me-2&quot;&gt;&lt;/i&gt;&#10;            Tổng số sách đang mượn: &lt;strong&gt;{{ activeBorrows.length }}&lt;/strong&gt; |&#10;            Quá hạn: &lt;strong class=&quot;text-danger&quot;&gt;{{ overdueCount }}&lt;/strong&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- No borrowed books --&gt;&#10;        &lt;div v-else class=&quot;text-center py-5&quot;&gt;&#10;          &lt;i class=&quot;bi bi-bookmark-x fs-1 text-muted&quot;&gt;&lt;/i&gt;&#10;          &lt;p class=&quot;text-muted mt-2&quot;&gt;Bạn chưa mượn sách nào&lt;/p&gt;&#10;          &lt;router-link to=&quot;/docgia/search-books&quot; class=&quot;btn btn-primary&quot;&gt;&#10;            &lt;i class=&quot;bi bi-search me-1&quot;&gt;&lt;/i&gt;&#10;            Tìm sách để mượn&#10;          &lt;/router-link&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;!-- Book Detail Modal --&gt;&#10;    &lt;Transition name=&quot;modal-fade&quot;&gt;&#10;      &lt;div v-if=&quot;showDetailModal&quot; class=&quot;modal-backdrop&quot; @click=&quot;closeDetailModal&quot;&gt;&#10;        &lt;Transition name=&quot;modal-slide&quot;&gt;&#10;          &lt;div v-if=&quot;showDetailModal&quot; class=&quot;modal-dialog-wrapper&quot; @click.stop&gt;&#10;            &lt;div class=&quot;modal-content-custom&quot;&gt;&#10;              &lt;button type=&quot;button&quot; class=&quot;btn-close-custom&quot; @click=&quot;closeDetailModal&quot;&gt;&#10;                &lt;i class=&quot;bi bi-x-lg&quot;&gt;&lt;/i&gt;&#10;              &lt;/button&gt;&#10;&#10;              &lt;div class=&quot;modal-body-custom&quot;&gt;&#10;                &lt;!-- Loading state --&gt;&#10;                &lt;div v-if=&quot;isLoadingBookDetail&quot; class=&quot;book-detail-loading&quot;&gt;&#10;                  &lt;div class=&quot;spinner-border text-primary&quot; role=&quot;status&quot;&gt;&#10;                    &lt;span class=&quot;visually-hidden&quot;&gt;Đang tải...&lt;/span&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;p class=&quot;mt-3&quot;&gt;Đang tải thông tin sách...&lt;/p&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;!-- Book details --&gt;&#10;                &lt;div v-else-if=&quot;selectedBook&quot;&gt;&#10;                  &lt;div class=&quot;book-detail-image&quot;&gt;&#10;                    &lt;img&#10;                      :src=&quot;selectedBook.HinhAnh || 'https://via.placeholder.com/300x400?text=No+Image'&quot;&#10;                      :alt=&quot;selectedBook.TenSach&quot;&#10;                    /&gt;&#10;                  &lt;/div&gt;&#10;&#10;                  &lt;div class=&quot;book-detail-info&quot;&gt;&#10;                    &lt;h4 class=&quot;book-detail-title&quot;&gt;{{ selectedBook.TenSach }}&lt;/h4&gt;&#10;&#10;                    &lt;div class=&quot;book-detail-meta&quot;&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-person-fill me-1&quot;&gt;&lt;/i&gt;Tác giả:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;{{ selectedBook.TacGia }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-calendar-event me-1&quot;&gt;&lt;/i&gt;Năm xuất bản:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;{{ formatYear(selectedBook.NamXuatBan) }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-building me-1&quot;&gt;&lt;/i&gt;Nhà xuất bản:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;{{ getPublisherName(selectedBook.IdNxb) }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-cash me-1&quot;&gt;&lt;/i&gt;Đơn giá:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value text-success fw-bold&quot;&gt;{{ formatPrice(selectedBook.DonGia) }}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-book-half me-1&quot;&gt;&lt;/i&gt;Số lượng:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;&#10;                          &lt;span :class=&quot;selectedBook.SoQuyen &gt; 0 ? 'text-success' : 'text-danger'&quot;&gt;&#10;                            {{ selectedBook.SoQuyen }} quyển&#10;                          &lt;/span&gt;&#10;                        &lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;div class=&quot;meta-row&quot;&gt;&#10;                        &lt;span class=&quot;meta-label&quot;&gt;&#10;                          &lt;i class=&quot;bi bi-check-circle me-1&quot;&gt;&lt;/i&gt;Tình trạng:&#10;                        &lt;/span&gt;&#10;                        &lt;span class=&quot;meta-value&quot;&gt;&#10;                          &lt;span :class=&quot;selectedBook.SoQuyen &gt; 0 ? 'badge bg-success' : 'badge bg-danger'&quot;&gt;&#10;                            {{ selectedBook.SoQuyen &gt; 0 ? 'Còn sách' : 'Hết sách' }}&#10;                          &lt;/span&gt;&#10;                        &lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div class=&quot;modal-footer-custom&quot;&gt;&#10;                &lt;button class=&quot;btn btn-secondary&quot; @click=&quot;closeDetailModal&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;                  Đóng&#10;                &lt;/button&gt;&#10;                &lt;button&#10;                  class=&quot;btn btn-gradient&quot;&#10;                  @click=&quot;borrowFromDetail&quot;&#10;                  :disabled=&quot;isLoadingBookDetail || !selectedBook || selectedBook.SoQuyen === 0&quot;&#10;                &gt;&#10;                  &lt;i class=&quot;bi bi-bookmark-plus me-1&quot;&gt;&lt;/i&gt;&#10;                  Mượn lại&#10;                &lt;/button&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/Transition&gt;&#10;      &lt;/div&gt;&#10;    &lt;/Transition&gt;&#10;&#10;    &lt;!-- Borrow Again Modal --&gt;&#10;    &lt;Transition name=&quot;modal-fade&quot;&gt;&#10;      &lt;div v-if=&quot;showBorrowModal&quot; class=&quot;modal-backdrop&quot; @click=&quot;closeBorrowModal&quot;&gt;&#10;        &lt;Transition name=&quot;modal-slide&quot;&gt;&#10;          &lt;div v-if=&quot;showBorrowModal&quot; class=&quot;modal-dialog-wrapper-small&quot; @click.stop&gt;&#10;            &lt;div class=&quot;modal-content-custom&quot;&gt;&#10;              &lt;button type=&quot;button&quot; class=&quot;btn-close-custom&quot; @click=&quot;closeBorrowModal&quot;&gt;&#10;                &lt;i class=&quot;bi bi-x-lg&quot;&gt;&lt;/i&gt;&#10;              &lt;/button&gt;&#10;&#10;              &lt;div class=&quot;borrow-modal-content&quot;&gt;&#10;                &lt;div class=&quot;borrow-modal-icon&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-arrow-repeat&quot;&gt;&lt;/i&gt;&#10;                &lt;/div&gt;&#10;                &lt;h4 class=&quot;borrow-modal-title&quot;&gt;Mượn lại sách&lt;/h4&gt;&#10;&#10;                &lt;div v-if=&quot;selectedBook&quot; class=&quot;book-info-card&quot;&gt;&#10;                  &lt;h5&gt;{{ selectedBook.TenSach }}&lt;/h5&gt;&#10;                  &lt;p class=&quot;text-muted mb-2&quot;&gt;Tác giả: {{ selectedBook.TacGia }}&lt;/p&gt;&#10;                  &lt;p class=&quot;text-muted mb-0&quot;&gt;Còn lại: {{ selectedBook.SoQuyen }} quyển&lt;/p&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div class=&quot;form-group mb-3&quot;&gt;&#10;                  &lt;label class=&quot;form-label fw-bold&quot;&gt;Số lượng mượn&lt;/label&gt;&#10;                  &lt;input&#10;                    type=&quot;number&quot;&#10;                    v-model=&quot;borrowQuantity&quot;&#10;                    class=&quot;form-control&quot;&#10;                    min=&quot;1&quot;&#10;                    :max=&quot;selectedBook?.SoQuyen || 1&quot;&#10;                  /&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;!-- Alerts --&gt;&#10;                &lt;div v-if=&quot;borrowError&quot; class=&quot;alert alert-danger&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-exclamation-triangle-fill me-2&quot;&gt;&lt;/i&gt;&#10;                  {{ borrowError }}&#10;                &lt;/div&gt;&#10;                &lt;div v-if=&quot;borrowSuccess&quot; class=&quot;alert alert-success&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-check-circle-fill me-2&quot;&gt;&lt;/i&gt;&#10;                  {{ borrowSuccess }}&#10;                &lt;/div&gt;&#10;&#10;                &lt;div class=&quot;borrow-modal-actions&quot;&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot; @click=&quot;closeBorrowModal&quot; :disabled=&quot;isBorrowing&quot;&gt;&#10;                    &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;                    Hủy&#10;                  &lt;/button&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; @click=&quot;confirmBorrowAgain&quot; :disabled=&quot;isBorrowing&quot;&gt;&#10;                    &lt;span v-if=&quot;isBorrowing&quot;&gt;&#10;                      &lt;span class=&quot;spinner-border spinner-border-sm me-2&quot;&gt;&lt;/span&gt;&#10;                      Đang xử lý...&#10;                    &lt;/span&gt;&#10;                    &lt;span v-else&gt;&#10;                      &lt;i class=&quot;bi bi-check-lg me-1&quot;&gt;&lt;/i&gt;&#10;                      Xác nhận mượn&#10;                    &lt;/span&gt;&#10;                  &lt;/button&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/Transition&gt;&#10;      &lt;/div&gt;&#10;    &lt;/Transition&gt;&#10;&#10;    &lt;!-- Login Prompt Modal --&gt;&#10;    &lt;Transition name=&quot;modal-fade&quot;&gt;&#10;      &lt;div v-if=&quot;showLoginPrompt&quot; class=&quot;modal-backdrop&quot; @click=&quot;closeLoginPrompt&quot;&gt;&#10;        &lt;Transition name=&quot;modal-slide&quot;&gt;&#10;          &lt;div v-if=&quot;showLoginPrompt&quot; class=&quot;modal-dialog-wrapper-small&quot; @click.stop&gt;&#10;            &lt;div class=&quot;modal-content-custom&quot;&gt;&#10;              &lt;button type=&quot;button&quot; class=&quot;btn-close-custom&quot; @click=&quot;closeLoginPrompt&quot;&gt;&#10;                &lt;i class=&quot;bi bi-x-lg&quot;&gt;&lt;/i&gt;&#10;              &lt;/button&gt;&#10;&#10;              &lt;div class=&quot;login-prompt-content&quot;&gt;&#10;                &lt;div class=&quot;login-prompt-icon&quot;&gt;&#10;                  &lt;i class=&quot;bi bi-lock-fill&quot;&gt;&lt;/i&gt;&#10;                &lt;/div&gt;&#10;                &lt;h4 class=&quot;login-prompt-title&quot;&gt;Phiên đăng nhập hết hạn&lt;/h4&gt;&#10;                &lt;p class=&quot;login-prompt-message&quot;&gt;&#10;                  Phiên đăng nhập của bạn đã hết hạn. Vui lòng đăng nhập lại để tiếp tục mượn sách.&#10;                &lt;/p&gt;&#10;&#10;                &lt;div class=&quot;login-prompt-actions&quot;&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot; @click=&quot;closeLoginPrompt&quot;&gt;&#10;                    &lt;i class=&quot;bi bi-x-circle me-1&quot;&gt;&lt;/i&gt;&#10;                    Hủy&#10;                  &lt;/button&gt;&#10;                  &lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; @click=&quot;redirectToLogin&quot;&gt;&#10;                    &lt;i class=&quot;bi bi-box-arrow-in-right me-1&quot;&gt;&lt;/i&gt;&#10;                    Đăng nhập&#10;                  &lt;/button&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/Transition&gt;&#10;      &lt;/div&gt;&#10;    &lt;/Transition&gt;&#10;  &lt;/div&gt;&#10;&lt;/template&gt;&#10;&#10;&lt;script setup lang=&quot;ts&quot;&gt;&#10;import {ref, onMounted, computed} from 'vue'&#10;import {useRouter} from 'vue-router'&#10;import {bookService} from '../../services/bookService'&#10;import {authService} from '../../services/authService'&#10;import type {TheoDoiMuonSach, Sach} from '../../types/book'&#10;import {TrangThaiMuonSach, TrangThaiMuonSachLabel} from '../../types/book'&#10;&#10;const router = useRouter()&#10;const borrows = ref&lt;TheoDoiMuonSach[]&gt;([])&#10;const isLoading = ref(false)&#10;const errorMessage = ref('')&#10;&#10;// Search, filter, sort states&#10;const searchQuery = ref('')&#10;const statusFilter = ref&lt;string&gt;('all')&#10;const sortBy = ref('date_desc')&#10;&#10;// Pagination states&#10;const currentPage = ref(1)&#10;const itemsPerPage = ref(10)&#10;&#10;// Modal states&#10;const showDetailModal = ref(false)&#10;const showBorrowModal = ref(false)&#10;const showLoginPrompt = ref(false)&#10;const selectedBook = ref&lt;Sach | null&gt;(null)&#10;const borrowQuantity = ref(1)&#10;const isBorrowing = ref(false)&#10;const borrowError = ref('')&#10;const borrowSuccess = ref('')&#10;const isLoadingBookDetail = ref(false)&#10;&#10;// Show all borrows and let the status filter control visibility&#10;const activeBorrows = computed(() =&gt; {&#10;  let result = [...borrows.value]&#10;&#10;  // Search filter&#10;  if (searchQuery.value.trim()) {&#10;    const query = searchQuery.value.toLowerCase()&#10;    result = result.filter(b =&gt;&#10;      getBookTitle(b.MaSach).toLowerCase().includes(query) ||&#10;      getBookAuthor(b.MaSach).toLowerCase().includes(query)&#10;    )&#10;  }&#10;&#10;  // Status filter&#10;  if (statusFilter.value !== 'all') {&#10;    console.log('Filtering by status:', statusFilter.value)&#10;    console.log('Sample book status:', result[0]?.TrangThai)&#10;    result = result.filter(b =&gt; {&#10;      const match = b.TrangThai === statusFilter.value&#10;      if (!match) {&#10;        console.log(`No match: &quot;${b.TrangThai}&quot; !== &quot;${statusFilter.value}&quot;`)&#10;      }&#10;      return match&#10;    })&#10;    console.log('Filtered result count:', result.length)&#10;  }&#10;&#10;  return result&#10;})&#10;&#10;const sortedActiveBorrows = computed(() =&gt; {&#10;  const sorted = [...activeBorrows.value]&#10;&#10;  switch (sortBy.value) {&#10;    case 'date_asc':&#10;      return sorted.sort((a, b) =&gt; new Date(a.NgayMuon).getTime() - new Date(b.NgayMuon).getTime())&#10;    case 'date_desc':&#10;      return sorted.sort((a, b) =&gt; new Date(b.NgayMuon).getTime() - new Date(a.NgayMuon).getTime())&#10;    case 'due_date_asc':&#10;      return sorted.sort((a, b) =&gt; new Date(a.NgayTra).getTime() - new Date(b.NgayTra).getTime())&#10;    case 'name_asc':&#10;      return sorted.sort((a, b) =&gt; getBookTitle(a.MaSach).localeCompare(getBookTitle(b.MaSach)))&#10;    default:&#10;      return sorted&#10;  }&#10;})&#10;&#10;const totalPages = computed(() =&gt; {&#10;  return Math.ceil(sortedActiveBorrows.value.length / itemsPerPage.value)&#10;})&#10;&#10;const paginatedBorrows = computed(() =&gt; {&#10;  const start = (currentPage.value - 1) * itemsPerPage.value&#10;  const end = start + itemsPerPage.value&#10;  return sortedActiveBorrows.value.slice(start, end)&#10;})&#10;&#10;const displayPages = computed(() =&gt; {&#10;  const pages = []&#10;  const maxDisplay = 5&#10;  let startPage = Math.max(1, currentPage.value - Math.floor(maxDisplay / 2))&#10;  let endPage = Math.min(totalPages.value, startPage + maxDisplay - 1)&#10;&#10;  if (endPage - startPage &lt; maxDisplay - 1) {&#10;    startPage = Math.max(1, endPage - maxDisplay + 1)&#10;  }&#10;&#10;  for (let i = startPage; i &lt;= endPage; i++) {&#10;    pages.push(i)&#10;  }&#10;&#10;  return pages&#10;})&#10;&#10;const overdueCount = computed(() =&gt; {&#10;  return activeBorrows.value.filter(b =&gt; isOverdue(b.NgayTra)).length&#10;})&#10;&#10;const loadBorrowedBooks = async () =&gt; {&#10;  isLoading.value = true&#10;  errorMessage.value = ''&#10;&#10;  const userIdFromStorage = localStorage.getItem('userId')&#10;&#10;  if (!userIdFromStorage) {&#10;    errorMessage.value = 'Không tìm thấy thông tin người dùng'&#10;    isLoading.value = false&#10;    return&#10;  }&#10;&#10;  try {&#10;    borrows.value = await bookService.getMyBorrowedBooks(userIdFromStorage)&#10;&#10;    borrows.value = borrows.value.sort((a, b) =&gt; a.TrangThai.localeCompare(b.TrangThai))&#10;  } catch (error: any) {&#10;    errorMessage.value = error.message || 'Bạn chưa mượn sách nào'&#10;  } finally {&#10;    isLoading.value = false&#10;  }&#10;}&#10;&#10;const getBookTitle = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TenSach) {&#10;    return maSach.TenSach&#10;  }&#10;  return 'Đang tải...'&#10;}&#10;&#10;const getBookAuthor = (maSach: string | Sach): string =&gt; {&#10;  if (typeof maSach === 'object' &amp;&amp; maSach.TacGia) {&#10;    return maSach.TacGia&#10;  }&#10;  return '-'&#10;}&#10;&#10;const formatDate = (date: string): string =&gt; {&#10;  return new Date(date).toLocaleDateString('vi-VN')&#10;}&#10;&#10;const formatPrice = (price: number): string =&gt; {&#10;  return new Intl.NumberFormat('vi-VN', {style: 'currency', currency: 'VND'}).format(price)&#10;}&#10;&#10;const isOverdue = (ngayTra: string): boolean =&gt; {&#10;  return new Date(ngayTra) &lt; new Date()&#10;}&#10;&#10;const getStatusClass = (status: TrangThaiMuonSach): string =&gt; {&#10;  switch (status) {&#10;    case TrangThaiMuonSach.CHO_DUYET:&#10;      return 'badge bg-warning'&#10;    case TrangThaiMuonSach.DA_DUYET:&#10;      return 'badge bg-success'&#10;    case TrangThaiMuonSach.DA_TRA:&#10;      return 'badge bg-secondary'&#10;    default:&#10;      return 'badge bg-light text-dark'&#10;  }&#10;}&#10;&#10;const getStatusLabel = (status: TrangThaiMuonSach): string =&gt; {&#10;  return TrangThaiMuonSachLabel[status] || status&#10;}&#10;&#10;const formatYear = (date: string | Date): string =&gt; {&#10;  return new Date(date).getFullYear().toString()&#10;}&#10;&#10;const getPublisherName = (publisher: any): string =&gt; {&#10;  if (typeof publisher === 'object' &amp;&amp; publisher?.TenNXB) {&#10;    return publisher.TenNXB&#10;  }&#10;  return 'Đang tải...'&#10;}&#10;&#10;const getBook = (maSach: string | Sach): Sach | null =&gt; {&#10;  if (typeof maSach === 'object') {&#10;    return maSach&#10;  }&#10;  return null&#10;}&#10;&#10;// View book detail&#10;const viewBookDetail = async (maSach: string | Sach) =&gt; {&#10;  const book = getBook(maSach)&#10;  if (!book) {&#10;    return&#10;  }&#10;&#10;  isLoadingBookDetail.value = true&#10;  showDetailModal.value = true&#10;&#10;  try {&#10;    // Fetch latest book data from API to get current stock quantity&#10;    const latestBookData = await bookService.getBookById(book._id)&#10;    selectedBook.value = latestBookData&#10;  } catch (error: any) {&#10;    // If API fails, fallback to cached data&#10;    console.error('Failed to fetch latest book data:', error)&#10;    selectedBook.value = book&#10;  } finally {&#10;    isLoadingBookDetail.value = false&#10;  }&#10;}&#10;&#10;const closeDetailModal = () =&gt; {&#10;  showDetailModal.value = false&#10;}&#10;&#10;const borrowFromDetail = () =&gt; {&#10;  closeDetailModal()&#10;  if (selectedBook.value) {&#10;    borrowAgain(selectedBook.value)&#10;  }&#10;}&#10;&#10;// Quick borrow - instantly borrow 1 copy without modal&#10;const quickBorrow = async (maSach: string | Sach) =&gt; {&#10;  // Check if user is logged in&#10;  if (!authService.isAuthenticated()) {&#10;    showLoginPrompt.value = true&#10;    return&#10;  }&#10;&#10;  const book = getBook(maSach)&#10;  if (!book) {&#10;    return&#10;  }&#10;&#10;  // Confirm quick borrow&#10;  const bookTitle = getBookTitle(maSach)&#10;  if (!confirm(`Mượn nhanh &quot;${bookTitle}&quot; (1 quyển)?`)) {&#10;    return&#10;  }&#10;&#10;  try {&#10;    // Fetch latest book data to check current availability&#10;    const latestBookData = await bookService.getBookById(book._id)&#10;&#10;    // Check if book is available&#10;    if (latestBookData.SoQuyen === 0) {&#10;      alert('Sách hiện không còn để mượn')&#10;      return&#10;    }&#10;&#10;    // Show loading state&#10;    isBorrowing.value = true&#10;&#10;    // Submit borrow request with quantity 1&#10;    const userId = localStorage.getItem('userId')&#10;    if (!userId) {&#10;      alert('Không tìm thấy thông tin người dùng')&#10;      return&#10;    }&#10;&#10;    await bookService.borrowBook({&#10;      MaSach: latestBookData._id,&#10;      SoQuyen: 1&#10;    })&#10;&#10;    alert('✅ Yêu cầu mượn sách thành công! Chờ nhân viên duyệt.')&#10;&#10;    // Reload the borrowed books list&#10;    await loadBorrowedBooks()&#10;  } catch (error: any) {&#10;    alert(error.message || 'Không thể mượn sách. Vui lòng thử lại.')&#10;  } finally {&#10;    isBorrowing.value = false&#10;  }&#10;}&#10;&#10;// Borrow again functionality&#10;const borrowAgain = async (maSach: string | Sach) =&gt; {&#10;  // Check if user is logged in&#10;  if (!authService.isAuthenticated()) {&#10;    showLoginPrompt.value = true&#10;    return&#10;  }&#10;&#10;  const book = getBook(maSach)&#10;  if (!book) {&#10;    return&#10;  }&#10;&#10;  try {&#10;    // Fetch latest book data to check current availability&#10;    const latestBookData = await bookService.getBookById(book._id)&#10;&#10;    // Check if book is available&#10;    if (latestBookData.SoQuyen === 0) {&#10;      alert('Sách hiện không còn để mượn')&#10;      return&#10;    }&#10;&#10;    selectedBook.value = latestBookData&#10;    borrowQuantity.value = 1&#10;    borrowError.value = ''&#10;    borrowSuccess.value = ''&#10;    showBorrowModal.value = true&#10;  } catch (error: any) {&#10;    alert('Không thể tải thông tin sách. Vui lòng thử lại.')&#10;  }&#10;}&#10;&#10;const closeBorrowModal = () =&gt; {&#10;  showBorrowModal.value = false&#10;  borrowError.value = ''&#10;  borrowSuccess.value = ''&#10;}&#10;&#10;const confirmBorrowAgain = async () =&gt; {&#10;  if (!selectedBook.value) return&#10;&#10;  borrowError.value = ''&#10;  borrowSuccess.value = ''&#10;  isBorrowing.value = true&#10;&#10;  try {&#10;    const userId = localStorage.getItem('userId')&#10;    if (!userId) {&#10;      borrowError.value = 'Không tìm thấy thông tin người dùng'&#10;      return&#10;    }&#10;&#10;    await bookService.borrowBook({&#10;      MaSach: selectedBook.value._id,&#10;      SoQuyen: borrowQuantity.value&#10;    })&#10;&#10;    borrowSuccess.value = 'Yêu cầu mượn sách thành công!'&#10;&#10;    setTimeout(() =&gt; {&#10;      closeBorrowModal()&#10;      loadBorrowedBooks() // Reload the list&#10;    }, 1500)&#10;  } catch (error: any) {&#10;    borrowError.value = error.message || 'Không thể mượn sách. Vui lòng thử lại.'&#10;  } finally {&#10;    isBorrowing.value = false&#10;  }&#10;}&#10;&#10;// Login prompt handlers&#10;const closeLoginPrompt = () =&gt; {&#10;  showLoginPrompt.value = false&#10;}&#10;&#10;const redirectToLogin = () =&gt; {&#10;  showLoginPrompt.value = false&#10;  router.push('/auth/login')&#10;}&#10;&#10;// Pagination handler&#10;const changePage = (page: number) =&gt; {&#10;  if (page &gt;= 1 &amp;&amp; page &lt;= totalPages.value) {&#10;    currentPage.value = page&#10;  }&#10;}&#10;&#10;// Cancel borrow request&#10;const cancelBorrowRequest = async (borrowId: string) =&gt; {&#10;  if (!confirm('Bạn có chắc chắn muốn hủy yêu cầu mượn sách này?')) {&#10;    return&#10;  }&#10;&#10;  try {&#10;    // Call the delete API to cancel the request&#10;    await bookService.cancelBorrowRequest(borrowId)&#10;    alert('Đã hủy yêu cầu mượn sách thành công')&#10;    await loadBorrowedBooks() // Reload the list&#10;  } catch (error: any) {&#10;    alert(error.message || 'Không thể hủy yêu cầu. Vui lòng thử lại.')&#10;  }&#10;}&#10;&#10;onMounted(() =&gt; {&#10;  loadBorrowedBooks()&#10;})&#10;&lt;/script&gt;&#10;&#10;&lt;style scoped&gt;&#10;.table-responsive {&#10;  border-radius: 8px;&#10;}&#10;&#10;.btn-group-sm .btn {&#10;  padding: 0.25rem 0.5rem;&#10;  font-size: 0.875rem;&#10;}&#10;&#10;/* Quick borrow button styling */&#10;.btn-outline-success {&#10;  transition: all 0.3s ease;&#10;}&#10;&#10;.btn-outline-success:hover:not(:disabled) {&#10;  background: linear-gradient(135deg, #10b981 0%, #059669 100%);&#10;  border-color: #10b981;&#10;  transform: translateY(-1px);&#10;  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);&#10;}&#10;&#10;.btn-outline-success i {&#10;  animation: pulse 2s infinite;&#10;}&#10;&#10;@keyframes pulse {&#10;  0%, 100% {&#10;    transform: scale(1);&#10;  }&#10;  50% {&#10;    transform: scale(1.1);&#10;  }&#10;}&#10;&#10;/* Modal Backdrop */&#10;.modal-backdrop {&#10;  position: fixed;&#10;  top: 0;&#10;  left: 0;&#10;  width: 100%;&#10;  height: 100%;&#10;  background: rgba(0, 0, 0, 0.7);&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  z-index: 9999;&#10;  padding: 1rem;&#10;}&#10;&#10;/* Modal Dialog Wrapper */&#10;.modal-dialog-wrapper {&#10;  max-width: 700px;&#10;  width: 100%;&#10;  max-height: 90vh;&#10;  overflow-y: auto;&#10;}&#10;&#10;.modal-dialog-wrapper-small {&#10;  max-width: 450px;&#10;  width: 100%;&#10;}&#10;&#10;/* Modal Content */&#10;.modal-content-custom {&#10;  background: white;&#10;  border-radius: 16px;&#10;  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);&#10;  position: relative;&#10;  overflow: hidden;&#10;}&#10;&#10;/* Close Button */&#10;.btn-close-custom {&#10;  position: absolute;&#10;  top: 1rem;&#10;  right: 1rem;&#10;  z-index: 10;&#10;  background: rgba(255, 255, 255, 0.9);&#10;  border: none;&#10;  border-radius: 50%;&#10;  width: 36px;&#10;  height: 36px;&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  cursor: pointer;&#10;  transition: all 0.2s;&#10;}&#10;&#10;.btn-close-custom:hover {&#10;  background: white;&#10;  transform: rotate(90deg);&#10;}&#10;&#10;.btn-close-custom i {&#10;  font-size: 1.2rem;&#10;  color: #333;&#10;}&#10;&#10;/* Modal Body */&#10;.modal-body-custom {&#10;  padding: 0;&#10;}&#10;&#10;/* Book Detail Image */&#10;.book-detail-image {&#10;  width: 100%;&#10;  height: 300px;&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;}&#10;&#10;.book-detail-image img {&#10;  height: 100%;&#10;  max-width: 100%;&#10;  object-fit: contain;&#10;}&#10;&#10;/* Book Detail Loading */&#10;.book-detail-loading {&#10;  padding: 4rem 2rem;&#10;  text-align: center;&#10;  min-height: 300px;&#10;  display: flex;&#10;  flex-direction: column;&#10;  align-items: center;&#10;  justify-content: center;&#10;}&#10;&#10;.book-detail-loading p {&#10;  color: #4a5568;&#10;  font-size: 1rem;&#10;  margin: 0;&#10;}&#10;&#10;/* Book Detail Info */&#10;.book-detail-info {&#10;  padding: 2rem;&#10;}&#10;&#10;.book-detail-title {&#10;  font-size: 1.75rem;&#10;  font-weight: 700;&#10;  color: #2d3748;&#10;  margin-bottom: 1.5rem;&#10;}&#10;&#10;.book-detail-meta {&#10;  display: flex;&#10;  flex-direction: column;&#10;  gap: 1rem;&#10;}&#10;&#10;.meta-row {&#10;  display: flex;&#10;  align-items: center;&#10;  padding: 0.75rem 0;&#10;  border-bottom: 1px solid #e2e8f0;&#10;}&#10;&#10;.meta-row:last-child {&#10;  border-bottom: none;&#10;}&#10;&#10;.meta-label {&#10;  min-width: 150px;&#10;  font-weight: 600;&#10;  color: #4a5568;&#10;  display: flex;&#10;  align-items: center;&#10;}&#10;&#10;.meta-value {&#10;  color: #2d3748;&#10;  font-weight: 500;&#10;}&#10;&#10;/* Modal Footer */&#10;.modal-footer-custom {&#10;  padding: 1.5rem 2rem;&#10;  background: #f7fafc;&#10;  display: flex;&#10;  gap: 1rem;&#10;  justify-content: flex-end;&#10;}&#10;&#10;.modal-footer-custom .btn {&#10;  padding: 0.75rem 1.5rem;&#10;  font-weight: 600;&#10;  border-radius: 8px;&#10;}&#10;&#10;/* Borrow Modal Content */&#10;.borrow-modal-content {&#10;  padding: 3rem 2rem;&#10;  text-align: center;&#10;}&#10;&#10;.borrow-modal-icon {&#10;  width: 80px;&#10;  height: 80px;&#10;  margin: 0 auto 1.5rem;&#10;  background: linear-gradient(135deg, #10b981 0%, #059669 100%);&#10;  border-radius: 50%;&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);&#10;}&#10;&#10;.borrow-modal-icon i {&#10;  font-size: 2.5rem;&#10;  color: white;&#10;}&#10;&#10;.borrow-modal-title {&#10;  font-size: 1.75rem;&#10;  font-weight: 700;&#10;  color: #2d3748;&#10;  margin-bottom: 1.5rem;&#10;}&#10;&#10;.book-info-card {&#10;  background: #f7fafc;&#10;  padding: 1.5rem;&#10;  border-radius: 12px;&#10;  margin-bottom: 1.5rem;&#10;  text-align: left;&#10;}&#10;&#10;.book-info-card h5 {&#10;  color: #2d3748;&#10;  font-weight: 700;&#10;  margin-bottom: 0.5rem;&#10;}&#10;&#10;.form-group {&#10;  text-align: left;&#10;}&#10;&#10;.form-label {&#10;  color: #4a5568;&#10;  margin-bottom: 0.5rem;&#10;}&#10;&#10;.form-control {&#10;  border-radius: 8px;&#10;  border: 1px solid #d2d6da;&#10;  padding: 0.75rem;&#10;  font-size: 1rem;&#10;}&#10;&#10;.form-control:focus {&#10;  border-color: #667eea;&#10;  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);&#10;}&#10;&#10;.borrow-modal-actions {&#10;  display: flex;&#10;  gap: 1rem;&#10;  justify-content: center;&#10;  margin-top: 1.5rem;&#10;}&#10;&#10;.borrow-modal-actions .btn {&#10;  padding: 0.75rem 1.5rem;&#10;  font-weight: 600;&#10;  border-radius: 8px;&#10;  transition: all 0.3s;&#10;}&#10;&#10;.borrow-modal-actions .btn-secondary {&#10;  background: #e2e8f0;&#10;  border: none;&#10;  color: #4a5568;&#10;}&#10;&#10;.borrow-modal-actions .btn-secondary:hover {&#10;  background: #cbd5e0;&#10;  transform: translateY(-2px);&#10;}&#10;&#10;.borrow-modal-actions .btn-primary {&#10;  background: linear-gradient(135deg, #10b981 0%, #059669 100%);&#10;  border: none;&#10;}&#10;&#10;.borrow-modal-actions .btn-primary:hover:not(:disabled) {&#10;  transform: translateY(-2px);&#10;  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);&#10;}&#10;&#10;/* Login Prompt Modal */&#10;.login-prompt-content {&#10;  padding: 3rem 2rem;&#10;  text-align: center;&#10;}&#10;&#10;.login-prompt-icon {&#10;  width: 80px;&#10;  height: 80px;&#10;  margin: 0 auto 1.5rem;&#10;  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);&#10;  border-radius: 50%;&#10;  display: flex;&#10;  align-items: center;&#10;  justify-content: center;&#10;  box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);&#10;}&#10;&#10;.login-prompt-icon i {&#10;  font-size: 2.5rem;&#10;  color: white;&#10;}&#10;&#10;.login-prompt-title {&#10;  font-size: 1.75rem;&#10;  font-weight: 700;&#10;  color: #2d3748;&#10;  margin-bottom: 1rem;&#10;}&#10;&#10;.login-prompt-message {&#10;  color: #4a5568;&#10;  font-size: 1.05rem;&#10;  margin-bottom: 2rem;&#10;  line-height: 1.6;&#10;}&#10;&#10;.login-prompt-actions {&#10;  display: flex;&#10;  gap: 1rem;&#10;  justify-content: center;&#10;}&#10;&#10;.login-prompt-actions .btn {&#10;  padding: 0.75rem 1.5rem;&#10;  font-weight: 600;&#10;  border-radius: 8px;&#10;  transition: all 0.3s;&#10;}&#10;&#10;.login-prompt-actions .btn-secondary {&#10;  background: #e2e8f0;&#10;  border: none;&#10;  color: #4a5568;&#10;}&#10;&#10;.login-prompt-actions .btn-secondary:hover {&#10;  background: #cbd5e0;&#10;  transform: translateY(-2px);&#10;}&#10;&#10;.login-prompt-actions .btn-primary {&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;  border: none;&#10;}&#10;&#10;.login-prompt-actions .btn-primary:hover {&#10;  transform: translateY(-2px);&#10;  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);&#10;}&#10;&#10;/* Alerts */&#10;.alert {&#10;  border-radius: 8px;&#10;  border: none;&#10;  padding: 1rem;&#10;  margin-bottom: 1rem;&#10;}&#10;&#10;/* Modal Transitions */&#10;.modal-fade-enter-active,&#10;.modal-fade-leave-active {&#10;  transition: opacity 0.3s ease;&#10;}&#10;&#10;.modal-fade-enter-from,&#10;.modal-fade-leave-to {&#10;  opacity: 0;&#10;}&#10;&#10;.modal-slide-enter-active,&#10;.modal-slide-leave-active {&#10;  transition: all 0.3s ease;&#10;}&#10;&#10;.modal-slide-enter-from {&#10;  transform: translateY(-50px);&#10;  opacity: 0;&#10;}&#10;&#10;.modal-slide-leave-to {&#10;  transform: translateY(50px);&#10;  opacity: 0;&#10;}&#10;&#10;.btn-gradient {&#10;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;  border: none;&#10;  color: white;&#10;  transition: all 0.3s;&#10;}&#10;&#10;.btn-gradient:hover:not(:disabled) {&#10;  transform: translateY(-2px);&#10;  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);&#10;}&#10;&#10;/* Responsive */&#10;@media (max-width: 768px) {&#10;  .modal-dialog-wrapper,&#10;  .modal-dialog-wrapper-small {&#10;    max-width: 95%;&#10;  }&#10;&#10;  .book-detail-image {&#10;    height: 250px;&#10;  }&#10;&#10;  .book-detail-info {&#10;    padding: 1.5rem;&#10;  }&#10;&#10;  .book-detail-title {&#10;    font-size: 1.5rem;&#10;  }&#10;&#10;  .meta-label {&#10;    min-width: 100px;&#10;    font-size: 0.9rem;&#10;  }&#10;&#10;  .modal-footer-custom,&#10;  .borrow-modal-actions,&#10;  .login-prompt-actions {&#10;    flex-direction: column;&#10;  }&#10;&#10;  .borrow-modal-content,&#10;  .login-prompt-content {&#10;    padding: 2rem 1.5rem;&#10;  }&#10;&#10;  .borrow-modal-title,&#10;  .login-prompt-title {&#10;    font-size: 1.5rem;&#10;  }&#10;&#10;  .login-prompt-message {&#10;    font-size: 1rem;&#10;  }&#10;}&#10;&lt;/style&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>